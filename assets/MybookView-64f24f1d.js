import{K as A,J as x,x as r,N as C,P as I,Q as o,c as n,ad as S,am as U,V as _,U as $,_ as K}from"./index-515d7cab.js";import{V as L}from"./VContainer-7dfdcdac.js";import{a as T,V as z}from"./VRow-1877bb51.js";import{V as D}from"./VDataTable-5e09745a.js";import{V as H}from"./VRating-c9b79e2f.js";import"./VList-7331a2d7.js";import"./VDivider-2163616c.js";import"./VSelectionControl-cba44c3e.js";const w=55,G={__name:"MybookView",setup(M){const{apiAuth:f}=K(),g=A(),P=x(),p=r(10),u=r([{key:"createdAt",order:"desc"}]),c=r(1),m=r([]);console.log(m.value);const B=[{title:"圖片",align:"center",sortable:!1,key:"image",value:a=>a.result.image},{title:"書名",align:"center",sortable:!0,key:"result.title"},{title:"作者",align:"center",sortable:!0,key:"result.authors"},{title:"出版者",align:"center",sortable:!0,key:"result.publisher"},{title:"分類",align:"center",sortable:!0,key:"result.categories"},{title:"評分(1-5)",align:"center",sortable:!0,key:"result.rating",value:a=>{const t=a.result.reviews.find(e=>e.user.$oid===g.value);return t?t.rating:"未提供評分"},cellTemplate:a=>`<v-rating :value="${a}" readonly color="#4d4637 darken-3" size="20"></v-rating>`},{title:"書評",align:"center",sortable:!1,key:"result.review",value:a=>{const t=a.result.reviews.find(e=>e.user.$oid===g.value);if(t){const e=t.comment,s=[];for(let l=0;l<e.length;l+=w)s.push(e.substring(l,l+w));return s.join(`
`)}else return"未提供書評"}}],v=r(!0),k=r(0),d=r(""),i=async()=>{var a,t;v.value=!0;try{const{data:e}=await f.get("/users/favorite");console.log(e);const l=e.result.map(b=>{var V,h;return f.get(`/books/${b}`,{params:{page:c.value,itemsPerPage:p.value,sortBy:((V=u.value[0])==null?void 0:V.key)||"createdAt",sortOrder:((h=u.value[0])==null?void 0:h.order)==="asc"?1:-1,search:d.value}})}),R=(await Promise.all(l)).map(b=>b.data);m.value.splice(0,m.value.length,...R),k.value=e.result.length}catch(e){console.log(e);const s=((t=(a=e==null?void 0:e.response)==null?void 0:a.data)==null?void 0:t.message)||"發生錯誤，請稍後再試";P({text:s,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom"}})}v.value=!1};i();const y=()=>{c.value=1,i()};return(a,t)=>(C(),I(L,null,{default:o(()=>[n(z,null,{default:o(()=>[n(T,{cols:"12"},{default:o(()=>[n(D,{"items-per-page":p.value,"onUpdate:itemsPerPage":[t[1]||(t[1]=e=>p.value=e),i],"sort-by":u.value,"onUpdate:sortBy":[t[2]||(t[2]=e=>u.value=e),i],page:c.value,"onUpdate:page":[t[3]||(t[3]=e=>c.value=e),i],items:m.value,headers:B,loading:v.value,"items-length":k.value,search:d.value,hover:""},{top:o(()=>[n(S,{label:"搜尋","append-icon":"mdi-magnify",modelValue:d.value,"onUpdate:modelValue":t[0]||(t[0]=e=>d.value=e),"onClick:append":y,onKeydown:U(y,["enter"])},null,8,["modelValue"])]),"item.image":o(({item:e})=>[n(_,{src:e.result.image},null,8,["src"])]),"item.starRating":o(({item:e})=>{var s;return[n(H,{value:((s=e.result.reviews.find(l=>l.user.$oid===$(g).value))==null?void 0:s.rating)||0,readonly:"",color:"#4d4637 darken-3",size:"20"},null,8,["value"])]}),_:2},1032,["items-per-page","sort-by","page","items","loading","items-length","search"])]),_:1})]),_:1})]),_:1}))}};export{G as default};
