import{J as F,x as h,N as L,P as N,Q as o,_ as T,c as e,ad as r,as as j,am as A,Y as I,ag as $,U as s,aa as _,V as K,a8 as M,al as q,H as z,X as D,ah as H,at as J}from"./index-515d7cab.js";import{u as Q,a as n,V as X}from"./vee-validate.esm-4d263e8b.js";import{V as Y}from"./VContainer-7dfdcdac.js";import{a as d,V as c}from"./VRow-1877bb51.js";import{V as E}from"./VTextarea-1a93bec5.js";const G=H("h1",{class:"text-center"},"引入書籍",-1),te={__name:"ImportView",setup(O){const{apiAuth:C}=T(),v=F(),P=h(!1),w=h(!1),m=h(""),{handleSubmit:B}=Q({initialValues:{title:"",authors:"",publisher:"",retailPrice:"",categories:"",description:"",image:"",maturityRating:"",buyLink:""}}),f=n("title"),p=n("authors"),V=n("publisher"),b=n("retailPrice"),g=n("categories"),y=n("description"),x=n("image"),U=n("maturityRating"),S=n("buyLink"),R=B(async i=>{var a,l;console.log(i);try{const u=new FormData;for(const t in i)u.append(t,i[t]);await C.post("/books",u),v({text:"新增成功",showCloseButton:!1,snackbarProps:{timeout:2e3,color:"green",location:"bottom"}})}catch(u){console.log(u);const t=((l=(a=u==null?void 0:u.response)==null?void 0:a.data)==null?void 0:l.message)||"發生錯誤，請稍後再試";v({text:t,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom"}})}}),k=async()=>{var i,a;if(m.value.trim())try{const l=/^\d{10}(\d{3})?$/.test(m.value),u=encodeURIComponent(m.value.trim()),{data:t}=await J.get(`https://www.googleapis.com/books/v1/volumes?q=${l?"isbn":"intitle"}:${u}`);console.log(t),t&&t.items&&t.items.length>0&&(f.value.value=t.items[0].volumeInfo.title,p.value.value=t.items[0].volumeInfo.authors,V.value.value=t.items[0].volumeInfo.publisher,b.value.value=t.items[0].saleInfo.retailPrice?t.items[0].saleInfo.retailPrice.amount:null,g.value.value=t.items[0].volumeInfo.categories,y.value.value=t.items[0].volumeInfo.description,x.value.value=t.items[0].volumeInfo.imageLinks.thumbnail,U.value.value=t.items[0].volumeInfo.maturityRating,S.value.value=t.items[0].saleInfo.buyLink,v({text:"引入成功",showCloseButton:!1,snackbarProps:{timeout:2e3,color:"green",location:"bottom"}}))}catch(l){console.error(l);const u=((a=(i=l==null?void 0:l.response)==null?void 0:i.data)==null?void 0:a.message)||"查無此書";v({text:u,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom"}}),f.value.value="",p.value.value="",V.value.value="",b.value.value="",g.value.value="",y.value.value="",x.value.value=""}};return(i,a)=>(L(),N(Y,null,{default:o(()=>[e(c,null,{default:o(()=>[e(d,{cols:"12"},{default:o(()=>[G]),_:1})]),_:1}),e(I,null,{default:o(()=>[e(c,null,{default:o(()=>[e(d,null,{default:o(()=>[e(r,{class:"mx-auto mt-5",modelValue:m.value,"onUpdate:modelValue":a[0]||(a[0]=l=>m.value=l),density:"comfortable","menu-icon":"",placeholder:"請輸入書籍名稱或13碼的isbn進行搜尋","prepend-inner-icon":"mdi-magnify",rounded:"",theme:"light",variant:"solo",style:j({width:P.value?"100%":"500px"}),"onClick:append":k,onKeydown:A(k,["enter"])},null,8,["modelValue","style"])]),_:1})]),_:1})]),_:1}),e(c,null,{default:o(()=>[e(d,{class:"d-flex justify-center",cols:"12"},{default:o(()=>[e(X,{disabled:w.value,onSubmit:$(s(R),["prevent"])},{default:o(()=>[e(_,null,{default:o(()=>[e(c,{class:"flex justify-center align-center"},{default:o(()=>[e(d,null,{default:o(()=>[e(_,{class:"d-flex justify-center align-center",outlined:""},{default:o(()=>[e(K,{src:s(x).value.value,width:"300px",cover:"",readonly:""},null,8,["src"])]),_:1})]),_:1}),e(d,{class:"me-2"},{default:o(()=>[e(M),e(r,{label:"書本名稱",modelValue:s(f).value.value,"onUpdate:modelValue":a[1]||(a[1]=l=>s(f).value.value=l),width:300,readonly:""},null,8,["modelValue"]),e(r,{label:"作者",modelValue:s(p).value.value,"onUpdate:modelValue":a[2]||(a[2]=l=>s(p).value.value=l),readonly:""},null,8,["modelValue"]),e(r,{label:"出版者",modelValue:s(V).value.value,"onUpdate:modelValue":a[3]||(a[3]=l=>s(V).value.value=l),readonly:""},null,8,["modelValue"]),e(r,{label:"價格",modelValue:s(b).value.value,"onUpdate:modelValue":a[4]||(a[4]=l=>s(b).value.value=l),readonly:""},null,8,["modelValue"]),e(r,{label:"分類",modelValue:s(g).value.value,"onUpdate:modelValue":a[5]||(a[5]=l=>s(g).value.value=l),readonly:""},null,8,["modelValue"]),e(E,{label:"簡介",modelValue:s(y).value.value,"onUpdate:modelValue":a[6]||(a[6]=l=>s(y).value.value=l),readonly:""},null,8,["modelValue"]),e(q)]),_:1})]),_:1})]),_:1}),e(c,{class:"text-center mb-5",cols:"12"},{default:o(()=>[e(d,null,{default:o(()=>[e(I),e(z,{color:"green",type:"submit",loading:w.value},{default:o(()=>[D("送出")]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["disabled","onSubmit"])]),_:1})]),_:1})]),_:1}))}};export{te as default};
