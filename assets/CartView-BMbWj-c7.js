import{s as B,t as P,w as q,i,V as D}from"./index-CANbr4-6.js";import{b as f,e as g,H as S,a1 as I,a2 as n,ac as N,a3 as $,j as a,l as v,u as k,a6 as h,Z as y}from"./vue-vendor-DIljl67C.js";import{j,k as A,l as M}from"./icons-lO__YJTN.js";import{V as T}from"./VContainer-C7nz21F5.js";import{V as p}from"./VCol-CdbNcG-U.js";import{V as H}from"./VDivider-DnPVfxfZ.js";import{V as L}from"./VDataTable-DtS3m4Nn.js";import"./vuetify-vendor-BSJ2BONf.js";import"./VList-BrXhqb3f.js";import"./VChip-Cer_LD1I.js";import"./VSelectionControl-B42RyIit.js";const X={__name:"CartView",setup(R){const{apiAuth:c}=q(),l=B(),u=P(),b=N(),s=f([]),C=[{align:"center",sortable:!1,value:"name"},{title:"書本圖片",key:"book.image"},{title:"書本名稱",key:"book.title"},{title:"單價",key:"book.retailPrice"},{title:"數量",key:"quantity"},{title:"總價",key:"total",value:t=>t.book.retailPrice*t.quantity},{title:"操作",key:"action"}],_=g(()=>s.value.reduce((t,e)=>t+e.quantity*e.book.retailPrice,0)),m=async(t,e)=>{if(!u.isLogin){b.push("/login");return}try{const{data:o}=await c.patch("/users/cart",{book:t,quantity:e});u.cart=o.result,l({text:"新增成功",showCloseButton:!1,snackbarProps:{timeout:2e3,color:"green",location:"bottom"}});const r=s.value.findIndex(w=>w.book._id===t);s.value[r].quantity+=e,s.value[r].quantity<=0&&s.value.splice(r,1)}catch(o){const r=o?.response?.data?.message||"發生錯誤，請稍後再試";l({text:r,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom"}})}},x=g(()=>s.value.length>0),d=f(!1),V=async()=>{d.value=!0;try{await c.post("/orders"),u.cart=0,b.push("/orders"),l({text:"結帳成功",showCloseButton:!1,snackbarProps:{timeout:2e3,color:"green",location:"bottom"}})}catch(t){const e=t?.response?.data?.message||"發生錯誤，請稍後再試";l({text:e,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom"}})}d.value=!1};return S(async()=>{try{const{data:t}=await c.get("/users/cart");s.value.push(...t.result)}catch(t){const e=t?.response?.data?.message||"發生錯誤，請稍後再試";l({text:e,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom"}})}}),(t,e)=>($(),I(T,null,{default:n(()=>[a(p,{cols:"12"},{default:n(()=>e[0]||(e[0]=[v("h1",null,"購物車",-1)])),_:1,__:[0]}),a(H),a(p,{cols:"12"},{default:n(()=>[a(L,{items:s.value,headers:C},{"item.book.image":n(({item:o})=>[a(D,{src:o.book.image,alt:"Book Image","max-height":"100","max-width":"60"},null,8,["src"])]),"item.quantity":n(({item:o})=>[a(i,{variant:"text",icon:k(A),color:"red",onClick:r=>m(o.book._id,-1)},null,8,["icon","onClick"]),h(y(o.quantity),1),a(i,{variant:"text",icon:k(M),color:"green",onClick:r=>m(o.book._id,1)},null,8,["icon","onClick"])]),"item.action":n(({item:o})=>[a(i,{variant:"text",icon:k(j),color:"red",onClick:r=>m(o.book._id,o.quantity*-1)},null,8,["icon","onClick"])]),_:2},1032,["items"])]),_:1}),a(p,{class:"text-center",cols:"12"},{default:n(()=>[v("p",null,"總金額: "+y(_.value),1),a(i,{color:"green",disabled:!x.value,loading:d.value,onClick:V},{default:n(()=>e[1]||(e[1]=[h("結帳",-1)])),_:1,__:[1]},8,["disabled","loading"])]),_:1})]),_:1}))}};export{X as default};
