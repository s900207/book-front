var g=(n,p,c)=>new Promise((d,l)=>{var r=a=>{try{m(c.next(a))}catch(o){l(o)}},f=a=>{try{m(c.throw(a))}catch(o){l(o)}},m=a=>a.done?d(a.value):Promise.resolve(a.value).then(r,f);m((c=c.apply(n,p)).next())});import{_ as S,u as A,a as P}from"./index-DEE-id0k.js";import{r as y,J as T,R as I,k as F,E as U,D as x,F as h,G as t,L as V,M as C,H as e,a5 as v,a6 as N,a7 as $,Y as k,Z as b,a8 as w,a9 as _,aa as B,ab as j,a1 as R,ac as E,w as M,a0 as H,n as W,ad as z,ae as D,$ as q,Q as G,U as J,af as O}from"./vue-vendor-CO2Qqhmb.js";import{g as Q}from"./vendor-oObasS19.js";/* empty css                   */const Y={key:0,class:"mature-badge"},Z={style:{fontSize:"1.5em",color:"#750000",fontWeight:"bold"}},K={__name:"BooksCard",props:["_id","title","authors","publisher","retailPrice","categories","description","image","maturityRating"],setup(n){const{apiAuth:p}=P(),c=n,d=A(),l=y(!1),r=T(),f=I(),m=()=>g(null,null,function*(){if(!d.isLogin){f.push("/login");return}l.value=!l.value;try{const{data:s}=yield p.post("/users/favorite",{bookId:c._id,isFavorite:l.value});console.log(s),d.favorite=s.result,l.value?r({text:"已加入我的最愛",showCloseButton:!1,snackbarProps:{timeout:2e3,color:"green",location:"bottom"}}):r({text:"已移除我的最愛",showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom"}})}catch(s){s.response&&s.response.status===401?f.push("/login"):(console.error(s),r({text:"發生錯誤，請稍後再試",showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom"}}))}}),a=()=>g(null,null,function*(){var s,i;if(!d.isLogin){f.push("/login");return}try{const{data:u}=yield p.patch("/users/cart",{book:c._id,quantity:1});d.cart=u.result,r({text:"新增成功",showCloseButton:!1,snackbarProps:{timeout:2e3,color:"green",location:"bottom"}})}catch(u){const L=((i=(s=u==null?void 0:u.response)==null?void 0:s.data)==null?void 0:i.message)||"發生錯誤，請稍後再試";r({text:L,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom"}})}});F(()=>g(null,null,function*(){d.isLogin&&(l.value=yield o())}));const o=()=>g(null,null,function*(){try{const{data:s}=yield p.get("/users/favorite",{params:{bookId:c._id}});return s.result.includes(c._id)}catch(s){return console.error(s),!1}});return(s,i)=>{const u=U("RouterLink");return h(),x(E,{class:"books-card hover-card",width:"250px",height:"380px"},{default:t(()=>[n.maturityRating==="MATURE"?(h(),V("div",Y,i[0]||(i[0]=[v("span",{class:"mature-text"},"18+",-1)]))):C("",!0),e(u,{to:"/books/"+n._id},{default:t(()=>[e(N,{src:n.image,height:"250px"},null,8,["src"])]),_:1},8,["to"]),e($,null,{default:t(()=>[e(u,{class:"text-primary text-decoration-none",to:"/books/"+n._id,title:n.title,style:{fontWeight:"bold"}},{default:t(()=>[k(b(n.title),1)]),_:1},8,["to","title"])]),_:1}),e(w,{class:"justify-space-between"},{default:t(()=>[e(_,{cols:"6"},{default:t(()=>[e(B,{class:"text-left",style:{width:"170px"},title:n.authors},{default:t(()=>[k(b(n.authors),1)]),_:1},8,["title"])]),_:1}),e(_,{class:"text-right",cols:"6"},{default:t(()=>[e(B,null,{default:t(()=>[i[1]||(i[1]=k("$",-1)),v("span",Z,b(n.retailPrice),1)]),_:1,__:[1]})]),_:1})]),_:1}),e(j,null,{default:t(()=>[e(w,{class:"justify-center align-center"},{default:t(()=>[e(_,{cols:"6"},{default:t(()=>[e(R,{class:"btn","prepend-icon":l.value?"mdi-heart-minus":"mdi-heart-plus",color:l.value?"red":"blue",onClick:m},{default:t(()=>[k(b(l.value?"取消最愛":"加入最愛"),1)]),_:1},8,["prepend-icon","color"])]),_:1}),e(_,{cols:"6"},{default:t(()=>[e(R,{class:"btn",color:"primary","prepend-icon":"mdi-cart",onClick:a},{default:t(()=>i[2]||(i[2]=[k("加入購物車",-1)])),_:1,__:[2]})]),_:1})]),_:1})]),_:1})]),_:1})}}},X=S(K,[["__scopeId","data-v-f8410830"]]),tt={class:"adult-switch-container mt-5 d-flex align-center"},et={class:"switch-indicators ml-2"},at={key:1,class:"adult-badge"},ot={__name:"HomeView",setup(n){const{api:p}=P(),c=T(),d=y([]),l=y(""),r=y(!1),f=()=>g(null,null,function*(){var m,a;try{const{data:o}=yield p.get("/books",{params:{search:l.value}}),s=o.result.data.reduce((i,u)=>((r.value||u.maturityRating==="NOT_MATURE")&&i.push(u),i),[]);d.value=s,yield W(),Q.to(".books-card",{opacity:1,duration:.5})}catch(o){console.log(o);const s=((a=(m=o==null?void 0:o.response)==null?void 0:m.data)==null?void 0:a.message)||"發生錯誤，請稍後再試";c({text:s,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom"}})}});return F(()=>{f()}),M([l,r],f),(m,a)=>(h(),x(H,null,{default:t(()=>[e(w,null,{default:t(()=>[e(_,{cols:"10",md:"11"},{default:t(()=>[e(z,{class:"mx-auto mt-5","menu-icon":"",placeholder:"請輸入書籍名稱","prepend-inner-icon":"mdi-magnify",modelValue:l.value,"onUpdate:modelValue":a[0]||(a[0]=o=>l.value=o)},null,8,["modelValue"])]),_:1}),e(_,{class:"d-flex mt-2 justify-end",cols:"2",md:"1"},{default:t(()=>[v("div",tt,[e(D,{class:"adult-switch",modelValue:r.value,"onUpdate:modelValue":a[1]||(a[1]=o=>r.value=o),color:r.value?"red":"green","hide-details":"",density:"compact"},null,8,["modelValue","color"]),v("div",et,[r.value?C("",!0):(h(),x(q,{key:0,color:"green",size:"small"},{default:t(()=>a[2]||(a[2]=[k("mdi-shield-check",-1)])),_:1,__:[2]})),r.value?(h(),V("div",at,a[3]||(a[3]=[v("span",{class:"adult-text"},"18+",-1)]))):C("",!0)])])]),_:1})]),_:1}),e(w,null,{default:t(()=>[(h(!0),V(G,null,J(d.value,o=>(h(),x(_,{class:"d-flex justify-center",cols:"12",md:"4",xl:"2",key:o._id},{default:t(()=>[e(X,O({ref_for:!0},o),null,16)]),_:2},1024))),128))]),_:1})]),_:1}))}},ct=S(ot,[["__scopeId","data-v-0b0caf27"]]);export{ct as default};
