var g=(C,c,s)=>new Promise((u,d)=>{var l=o=>{try{m(s.next(o))}catch(k){d(k)}},f=o=>{try{m(s.throw(o))}catch(k){d(k)}},m=o=>o.done?u(o.value):Promise.resolve(o.value).then(l,f);m((s=s.apply(C,c)).next())});import{u as D,a as S}from"./index-Bl098uTi.js";import{J as I,r as _,d as x,k as N,D as $,G as r,a0 as A,R,F as T,H as n,a9 as y,a5 as w,ag as F,aq as G,a1 as v,Y as B,Z as V,a6 as H}from"./vue-vendor-CO2Qqhmb.js";import"./vendor-oObasS19.js";/* empty css                   */const Z={__name:"CartView",setup(C){const{apiAuth:c}=S(),s=I(),u=D(),d=R(),l=_([]),f=[{align:"center",sortable:!1,value:"name"},{title:"書本圖片",key:"book.image"},{title:"書本名稱",key:"book.title"},{title:"單價",key:"book.retailPrice"},{title:"數量",key:"quantity"},{title:"總價",key:"total",value:a=>a.book.retailPrice*a.quantity},{title:"操作",key:"action"}],m=x(()=>l.value.reduce((a,e)=>a+e.quantity*e.book.retailPrice,0)),o=(a,e)=>g(null,null,function*(){var t,i;if(!u.isLogin){d.push("/login");return}try{const{data:p}=yield c.patch("/users/cart",{book:a,quantity:e});u.cart=p.result,s({text:"新增成功",showCloseButton:!1,snackbarProps:{timeout:2e3,color:"green",location:"bottom"}});const b=l.value.findIndex(P=>P.book._id===a);l.value[b].quantity+=e,l.value[b].quantity<=0&&l.value.splice(b,1)}catch(p){const b=((i=(t=p==null?void 0:p.response)==null?void 0:t.data)==null?void 0:i.message)||"發生錯誤，請稍後再試";s({text:b,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom"}})}}),k=x(()=>l.value.length>0),h=_(!1),q=()=>g(null,null,function*(){var a,e;h.value=!0;try{yield c.post("/orders"),u.cart=0,d.push("/orders"),s({text:"結帳成功",showCloseButton:!1,snackbarProps:{timeout:2e3,color:"green",location:"bottom"}})}catch(t){const i=((e=(a=t==null?void 0:t.response)==null?void 0:a.data)==null?void 0:e.message)||"發生錯誤，請稍後再試";s({text:i,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom"}})}h.value=!1});return N(()=>g(null,null,function*(){var a,e;try{const{data:t}=yield c.get("/users/cart");l.value.push(...t.result)}catch(t){const i=((e=(a=t==null?void 0:t.response)==null?void 0:a.data)==null?void 0:e.message)||"發生錯誤，請稍後再試";s({text:i,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom"}})}})),(a,e)=>(T(),$(A,null,{default:r(()=>[n(y,{cols:"12"},{default:r(()=>e[0]||(e[0]=[w("h1",null,"購物車",-1)])),_:1,__:[0]}),n(F),n(y,{cols:"12"},{default:r(()=>[n(G,{items:l.value,headers:f},{"item.book.image":r(({item:t})=>[n(H,{src:t.book.image,alt:"Book Image","max-height":"100","max-width":"60"},null,8,["src"])]),"item.quantity":r(({item:t})=>[n(v,{variant:"text",icon:"mdi-minus",color:"red",onClick:i=>o(t.book._id,-1)},null,8,["onClick"]),B(V(t.quantity),1),n(v,{variant:"text",icon:"mdi-plus",color:"green",onClick:i=>o(t.book._id,1)},null,8,["onClick"])]),"item.action":r(({item:t})=>[n(v,{variant:"text",icon:"mdi-delete",color:"red",onClick:i=>o(t.book._id,t.quantity*-1)},null,8,["onClick"])]),_:2},1032,["items"])]),_:1}),n(y,{class:"text-center",cols:"12"},{default:r(()=>[w("p",null,"總金額: "+V(m.value),1),n(v,{color:"green",disabled:!k.value,loading:h.value,onClick:q},{default:r(()=>e[1]||(e[1]=[B("結帳",-1)])),_:1,__:[1]},8,["disabled","loading"])]),_:1})]),_:1}))}};export{Z as default};
