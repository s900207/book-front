import{Y as R,X as x,x as l,$ as C,a0 as o,a5 as I,c as n,as as S,aA as $,V as U,a7 as _,ab as L}from"./index-8b7d5a47.js";import{V as T}from"./VContainer-b8cd4dd6.js";import{V as z}from"./VCol-d95151d3.js";import{V as D}from"./VDataTable-f4bb8d51.js";import{V as H}from"./VRating-5878b099.js";import{V as K}from"./VRow-252b8ae3.js";import"./VList-1bfa30b7.js";import"./VDivider-09e8f9a9.js";import"./VSelectionControl-5ece1eb7.js";const w=55,Q={__name:"MybookView",setup(M){const{apiAuth:f}=L(),p=R(),P=x(),d=l(10),u=l([{key:"createdAt",order:"desc"}]),c=l(1),m=l([]);console.log(m.value);const B=[{title:"圖片",align:"center",sortable:!1,key:"image",value:a=>a.result.image},{title:"書名",align:"center",sortable:!0,key:"result.title"},{title:"作者",align:"center",sortable:!0,key:"result.authors"},{title:"出版者",align:"center",sortable:!0,key:"result.publisher"},{title:"分類",align:"center",sortable:!0,key:"result.categories"},{title:"評分(1-5)",align:"center",sortable:!0,key:"result.rating",value:a=>{const t=a.result.reviews.find(e=>e.user.$oid===p.value);return t?t.rating:"未提供評分"},cellTemplate:a=>`<v-rating :value="${a}" readonly color="#4d4637 darken-3" size="20"></v-rating>`},{title:"書評",align:"center",sortable:!1,key:"result.review",value:a=>{const t=a.result.reviews.find(e=>e.user.$oid===p.value);if(t){const e=t.comment,s=[];for(let r=0;r<e.length;r+=w)s.push(e.substring(r,r+w));return s.join(`
`)}else return"未提供書評"}}],v=l(!0),k=l(0),g=l(""),i=async()=>{var a,t;v.value=!0;try{const{data:e}=await f.get("/users/favorite");console.log(e);const r=e.result.map(b=>{var V,h;return f.get(`/books/${b}`,{params:{page:c.value,itemsPerPage:d.value,sortBy:((V=u.value[0])==null?void 0:V.key)||"createdAt",sortOrder:((h=u.value[0])==null?void 0:h.order)==="asc"?1:-1,search:g.value}})}),A=(await Promise.all(r)).map(b=>b.data);m.value.splice(0,m.value.length,...A),k.value=e.result.length}catch(e){console.log(e);const s=((t=(a=e==null?void 0:e.response)==null?void 0:a.data)==null?void 0:t.message)||"發生錯誤，請稍後再試";P({text:s,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom"}})}v.value=!1};i();const y=()=>{c.value=1,i()};return(a,t)=>(I(),C(T,null,{default:o(()=>[n(K,null,{default:o(()=>[n(z,{cols:"12"},{default:o(()=>[n(D,{"items-per-page":d.value,"onUpdate:itemsPerPage":[t[1]||(t[1]=e=>d.value=e),i],"sort-by":u.value,"onUpdate:sortBy":[t[2]||(t[2]=e=>u.value=e),i],page:c.value,"onUpdate:page":[t[3]||(t[3]=e=>c.value=e),i],items:m.value,headers:B,loading:v.value,"items-length":k.value,search:g.value,hover:""},{top:o(()=>[n(S,{label:"搜尋","append-icon":"mdi-magnify",modelValue:g.value,"onUpdate:modelValue":t[0]||(t[0]=e=>g.value=e),"onClick:append":y,onKeydown:$(y,["enter"])},null,8,["modelValue"])]),"item.image":o(({item:e})=>[n(U,{src:e.result.image},null,8,["src"])]),"item.starRating":o(({item:e})=>{var s;return[n(H,{value:((s=e.result.reviews.find(r=>r.user.$oid===_(p).value))==null?void 0:s.rating)||0,readonly:"",color:"#4d4637 darken-3",size:"20"},null,8,["value"])]}),_:2},1032,["items-per-page","sort-by","page","items","loading","items-length","search"])]),_:1})]),_:1})]),_:1}))}};export{Q as default};
