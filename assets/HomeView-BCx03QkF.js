import{x as ue,y as ce,z as j,A as de,B as me,g as fe,C as ve,r as q,L as he,D as ge,_ as G,t as pe,s as J,w as Z,V as ke,E as _e,F as H,G as be,i as $,H as ye,I as Ve,J as we}from"./index-C_tv00P6.js";import{b as v,t as E,D as Ce,j as t,m as L,l as c,P as T,n as z,F as M,ac as xe,H as K,aa as Pe,a1 as U,a3 as _,a2 as a,a7 as B,a8 as D,a6 as w,Z as C,u as x,o as Be,I as Se,ad as Ie}from"./vue-vendor-DIljl67C.js";import{h as Re,i as Ae,c as Fe,j as Le,k as Te}from"./icons-BmvWcfYN.js";import{V as S}from"./VRow-DuJyZejm.js";import{V as b}from"./VCol-nel5MGKg.js";import{V as ze}from"./VContainer-CZi5Xp4O.js";import{V as O,m as Me}from"./VSelectionControl-CwyxR3d7.js";import{g as Ue,p as De,C as W,O as Ne,f as je,ae as He}from"./vuetify-vendor-CjpGIcAt.js";const $e=De({indeterminate:Boolean,inset:Boolean,flat:Boolean,loading:{type:[Boolean,String],default:!1},...me(),...Me()},"VSwitch"),Ee=Ue()({name:"VSwitch",inheritAttrs:!1,props:$e(),emits:{"update:focused":e=>!0,"update:modelValue":e=>!0,"update:indeterminate":e=>!0},setup(e,k){let{attrs:h,slots:o}=k;const i=W(e,"indeterminate"),l=W(e,"modelValue"),{loaderClasses:f}=ue(e),{isFocused:d,focus:m,blur:g}=ce(e),s=v(),n=v(),r=Ne&&window.matchMedia("(forced-colors: active)").matches,u=E(()=>typeof e.loading=="string"&&e.loading!==""?e.loading:e.color),y=Ce(),Q=E(()=>e.id||`switch-${y}`);function X(){i.value&&(i.value=!1)}function Y(P){P.stopPropagation(),P.preventDefault(),s.value?.input?.click()}return je(()=>{const[P,ee]=He(h),te=j.filterProps(e),ae=O.filterProps(e);return t(j,L({ref:n,class:["v-switch",{"v-switch--flat":e.flat},{"v-switch--inset":e.inset},{"v-switch--indeterminate":i.value},f.value,e.class]},P,te,{modelValue:l.value,"onUpdate:modelValue":I=>l.value=I,id:Q.value,focused:d.value,style:e.style}),{...o,default:I=>{let{id:se,messagesId:oe,isDisabled:le,isReadonly:ne,isValid:N}=I;const R={model:l,isValid:N};return t(O,L({ref:s},ae,{modelValue:l.value,"onUpdate:modelValue":[V=>l.value=V,X],id:se.value,"aria-describedby":oe.value,type:"checkbox","aria-checked":i.value?"mixed":void 0,disabled:le.value,readonly:ne.value,onFocus:m,onBlur:g},ee),{...o,default:V=>{let{backgroundColorClasses:A,backgroundColorStyles:p}=V;return c("div",{class:z(["v-switch__track",r?void 0:A.value]),style:T(p.value),onClick:Y},[o["track-true"]&&c("div",{key:"prepend",class:"v-switch__track-true"},[o["track-true"](R)]),o["track-false"]&&c("div",{key:"append",class:"v-switch__track-false"},[o["track-false"](R)])])},input:V=>{let{inputNode:A,icon:p,backgroundColorClasses:re,backgroundColorStyles:ie}=V;return c(M,null,[A,c("div",{class:z(["v-switch__thumb",{"v-switch__thumb--filled":p||e.loading},e.inset||r?void 0:re.value]),style:T(e.inset?void 0:ie.value)},[o.thumb?t(fe,{defaults:{VIcon:{icon:p,size:"x-small"}}},{default:()=>[o.thumb({...R,icon:p})]}):t(ve,null,{default:()=>[e.loading?t(he,{name:"v-switch",active:!0,color:N.value===!1?void 0:u.value},{default:F=>o.loader?o.loader(F):t(ge,{active:F.isActive,color:F.color,indeterminate:!0,size:"16",width:"2"},null)}):p&&t(q,{key:String(p),icon:p,size:"x-small"},null)]})])])}})}})}),de({},n)}}),Oe={key:0,class:"mature-badge"},We={style:{fontSize:"1.5em",color:"#750000",fontWeight:"bold"}},qe={__name:"BooksCard",props:["_id","title","authors","publisher","retailPrice","categories","description","image","maturityRating"],setup(e){const{apiAuth:k}=Z(),h=e,o=pe(),i=v(!1),l=J(),f=xe(),d=async()=>{if(!o.isLogin){f.push("/login");return}i.value=!i.value;try{const{data:s}=await k.post("/users/favorite",{bookId:h._id,isFavorite:i.value});console.log(s),o.favorite=s.result,i.value?l({text:"已加入我的最愛",showCloseButton:!1,snackbarProps:{timeout:2e3,color:"green",location:"bottom"}}):l({text:"已移除我的最愛",showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom"}})}catch(s){s.response&&s.response.status===401?f.push("/login"):(console.error(s),l({text:"發生錯誤，請稍後再試",showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom"}}))}},m=async()=>{if(!o.isLogin){f.push("/login");return}try{const{data:s}=await k.patch("/users/cart",{book:h._id,quantity:1});o.cart=s.result,l({text:"新增成功",showCloseButton:!1,snackbarProps:{timeout:2e3,color:"green",location:"bottom"}})}catch(s){const n=s?.response?.data?.message||"發生錯誤，請稍後再試";l({text:n,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom"}})}};K(async()=>{o.isLogin&&(i.value=await g())});const g=async()=>{try{const{data:s}=await k.get("/users/favorite",{params:{bookId:h._id}});return s.result.includes(h._id)}catch(s){return console.error(s),!1}};return(s,n)=>{const r=Pe("RouterLink");return _(),U(ye,{class:"books-card hover-card",width:"250px",height:"380px"},{default:a(()=>[e.maturityRating==="MATURE"?(_(),B("div",Oe,n[0]||(n[0]=[c("span",{class:"mature-text"},"18+",-1)]))):D("",!0),t(r,{to:"/books/"+e._id},{default:a(()=>[t(ke,{src:e.image,height:"250px"},null,8,["src"])]),_:1},8,["to"]),t(_e,null,{default:a(()=>[t(r,{class:"text-primary text-decoration-none",to:"/books/"+e._id,title:e.title,style:{fontWeight:"bold"}},{default:a(()=>[w(C(e.title),1)]),_:1},8,["to","title"])]),_:1}),t(S,{class:"justify-space-between"},{default:a(()=>[t(b,{cols:"6"},{default:a(()=>[t(H,{class:"text-left",style:{width:"170px"},title:e.authors},{default:a(()=>[w(C(e.authors),1)]),_:1},8,["title"])]),_:1}),t(b,{class:"text-right",cols:"6"},{default:a(()=>[t(H,null,{default:a(()=>[n[1]||(n[1]=w("$",-1)),c("span",We,C(e.retailPrice),1)]),_:1,__:[1]})]),_:1})]),_:1}),t(be,null,{default:a(()=>[t(S,{class:"justify-center align-center"},{default:a(()=>[t(b,{cols:"6"},{default:a(()=>[t($,{class:"btn","prepend-icon":i.value?x(Re):x(Ae),color:i.value?"red":"blue",onClick:d},{default:a(()=>[w(C(i.value?"取消最愛":"加入最愛"),1)]),_:1},8,["prepend-icon","color"])]),_:1}),t(b,{cols:"6"},{default:a(()=>[t($,{class:"btn",color:"primary","prepend-icon":x(Fe),onClick:m},{default:a(()=>n[2]||(n[2]=[w("加入購物車",-1)])),_:1,__:[2]},8,["prepend-icon"])]),_:1})]),_:1})]),_:1})]),_:1})}}},Ge=G(qe,[["__scopeId","data-v-1f089073"]]),Je={class:"loading-container"},Ze={class:"loading-content"},Ke={class:"loading-text"},Qe={class:"adult-switch-container mt-5 d-flex align-center"},Xe={class:"switch-indicators ml-2"},Ye={key:1,class:"adult-badge"},et={__name:"HomeView",setup(e){const{api:k}=Z(),h=J(),o=v([]),i=v(""),l=v(!1),f=v(!1),d=v(!1),m=v(0),g=n=>{const u=setInterval(()=>{m.value<n?m.value+=2:clearInterval(u)},50)},s=async()=>{try{d.value=!0,m.value=0,f.value=!1,g(30);const{data:n}=await k.get("/books",{params:{search:i.value}});g(60);const r=n.result.data.reduce((u,y)=>((l.value||y.maturityRating==="NOT_MATURE")&&u.push(y),u),[]);g(80),o.value=r,await Se(),g(100),setTimeout(()=>{d.value=!1,m.value=0,setTimeout(()=>{f.value=!0},100)},500)}catch(n){console.log(n);const r=n?.response?.data?.message||"發生錯誤，請稍後再試";d.value=!1,m.value=0,h({text:r,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom"}})}};return K(()=>{s()}),Be([i,l],s),(n,r)=>(_(),B(M,null,[t(Ve,{class:"loading-overlay",modelValue:d.value,"onUpdate:modelValue":r[0]||(r[0]=u=>d.value=u),persistent:""},{default:a(()=>[c("div",Je,[c("div",Ze,[c("div",Ke,C(m.value)+"% Loading...",1)])])]),_:1},8,["modelValue"]),t(ze,null,{default:a(()=>[t(S,null,{default:a(()=>[t(b,{cols:"10",md:"11"},{default:a(()=>[t(we,{class:"mx-auto mt-5","menu-icon":"",placeholder:"請輸入書籍名稱","prepend-inner-icon":x(Le),modelValue:i.value,"onUpdate:modelValue":r[1]||(r[1]=u=>i.value=u),disabled:d.value},null,8,["prepend-inner-icon","modelValue","disabled"])]),_:1}),t(b,{class:"d-flex mt-2 justify-end",cols:"2",md:"1"},{default:a(()=>[c("div",Qe,[t(Ee,{class:"adult-switch",modelValue:l.value,"onUpdate:modelValue":r[2]||(r[2]=u=>l.value=u),color:l.value?"red":"green","hide-details":"",density:"compact",disabled:d.value},null,8,["modelValue","color","disabled"]),c("div",Xe,[l.value?D("",!0):(_(),U(q,{key:0,color:"green",size:"small",icon:x(Te)},null,8,["icon"])),l.value?(_(),B("div",Ye,r[3]||(r[3]=[c("span",{class:"adult-text"},"18+",-1)]))):D("",!0)])])]),_:1})]),_:1}),t(S,null,{default:a(()=>[(_(!0),B(M,null,Ie(o.value,(u,y)=>(_(),U(b,{class:"d-flex justify-center",cols:"12",md:"4",xl:"2",key:u._id},{default:a(()=>[c("div",{class:z(["book-wrapper",{"animate-in":f.value}]),style:T({animationDelay:`${y*.1}s`})},[t(Ge,L({ref_for:!0},u),null,16)],6)]),_:2},1024))),128))]),_:1})]),_:1})],64))}},ut=G(et,[["__scopeId","data-v-b68376c8"]]);export{ut as default};
