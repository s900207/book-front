import{x as ce,y as ue,z as D,A as de,B as fe,g as me,C as ve,r as E,L as he,D as ke,_ as O,t as pe,s as W,w as q,V as ge,E as ye,F as N,G as _e,i as U,H as be,I as Ve}from"./index-C3WM-jjV.js";import{b as k,t as j,D as we,j as t,m as A,l as c,P as F,n as T,F as G,ac as Ce,H as Z,aa as xe,a1 as x,a3 as h,a2 as o,a7 as L,a8 as z,a6 as b,Z as C,u as V,o as Be,I as Se,ad as Pe}from"./vue-vendor-DIljl67C.js";import{h as Re,i as Ie,c as Ae,j as Fe,k as Te}from"./icons-C5frdmYn.js";import{V as B}from"./VRow-CZ-cGUta.js";import{V as p}from"./VCol-Bo4hKSVn.js";import{V as Le}from"./VContainer-D_t0xiKR.js";import{V as H,m as ze}from"./VSelectionControl-Do2fDKV9.js";import{g as Me,p as De,C as $,O as Ne,f as Ue,ae as je}from"./vuetify-vendor-BSJ2BONf.js";const He=De({indeterminate:Boolean,inset:Boolean,flat:Boolean,loading:{type:[Boolean,String],default:!1},...fe(),...ze()},"VSwitch"),$e=Me()({name:"VSwitch",inheritAttrs:!1,props:He(),emits:{"update:focused":e=>!0,"update:modelValue":e=>!0,"update:indeterminate":e=>!0},setup(e,v){let{attrs:f,slots:s}=v;const n=$(e,"indeterminate"),l=$(e,"modelValue"),{loaderClasses:u}=ce(e),{isFocused:g,focus:d,blur:i}=ue(e),a=k(),r=k(),y=Ne&&window.matchMedia("(forced-colors: active)").matches,J=j(()=>typeof e.loading=="string"&&e.loading!==""?e.loading:e.color),K=we(),Q=j(()=>e.id||`switch-${K}`);function X(){n.value&&(n.value=!1)}function Y(w){w.stopPropagation(),w.preventDefault(),a.value?.input?.click()}return Ue(()=>{const[w,ee]=je(f),te=D.filterProps(e),ae=H.filterProps(e);return t(D,A({ref:r,class:["v-switch",{"v-switch--flat":e.flat},{"v-switch--inset":e.inset},{"v-switch--indeterminate":n.value},u.value,e.class]},w,te,{modelValue:l.value,"onUpdate:modelValue":S=>l.value=S,id:Q.value,focused:g.value,style:e.style}),{...s,default:S=>{let{id:oe,messagesId:se,isDisabled:le,isReadonly:ne,isValid:M}=S;const P={model:l,isValid:M};return t(H,A({ref:a},ae,{modelValue:l.value,"onUpdate:modelValue":[_=>l.value=_,X],id:oe.value,"aria-describedby":se.value,type:"checkbox","aria-checked":n.value?"mixed":void 0,disabled:le.value,readonly:ne.value,onFocus:d,onBlur:i},ee),{...s,default:_=>{let{backgroundColorClasses:R,backgroundColorStyles:m}=_;return c("div",{class:T(["v-switch__track",y?void 0:R.value]),style:F(m.value),onClick:Y},[s["track-true"]&&c("div",{key:"prepend",class:"v-switch__track-true"},[s["track-true"](P)]),s["track-false"]&&c("div",{key:"append",class:"v-switch__track-false"},[s["track-false"](P)])])},input:_=>{let{inputNode:R,icon:m,backgroundColorClasses:re,backgroundColorStyles:ie}=_;return c(G,null,[R,c("div",{class:T(["v-switch__thumb",{"v-switch__thumb--filled":m||e.loading},e.inset||y?void 0:re.value]),style:F(e.inset?void 0:ie.value)},[s.thumb?t(me,{defaults:{VIcon:{icon:m,size:"x-small"}}},{default:()=>[s.thumb({...P,icon:m})]}):t(ve,null,{default:()=>[e.loading?t(he,{name:"v-switch",active:!0,color:M.value===!1?void 0:J.value},{default:I=>s.loader?s.loader(I):t(ke,{active:I.isActive,color:I.color,indeterminate:!0,size:"16",width:"2"},null)}):m&&t(E,{key:String(m),icon:m,size:"x-small"},null)]})])])}})}})}),de({},r)}}),Ee={key:0,class:"mature-badge"},Oe={style:{fontSize:"1.5em",color:"#750000",fontWeight:"bold"}},We={__name:"BooksCard",props:["_id","title","authors","publisher","retailPrice","categories","description","image","maturityRating"],setup(e){const{apiAuth:v}=q(),f=e,s=pe(),n=k(!1),l=W(),u=Ce(),g=async()=>{if(!s.isLogin){u.push("/login");return}n.value=!n.value;try{const{data:a}=await v.post("/users/favorite",{bookId:f._id,isFavorite:n.value});console.log(a),s.favorite=a.result,n.value?l({text:"已加入我的最愛",showCloseButton:!1,snackbarProps:{timeout:2e3,color:"green",location:"bottom"}}):l({text:"已移除我的最愛",showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom"}})}catch(a){a.response&&a.response.status===401?u.push("/login"):(console.error(a),l({text:"發生錯誤，請稍後再試",showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom"}}))}},d=async()=>{if(!s.isLogin){u.push("/login");return}try{const{data:a}=await v.patch("/users/cart",{book:f._id,quantity:1});s.cart=a.result,l({text:"新增成功",showCloseButton:!1,snackbarProps:{timeout:2e3,color:"green",location:"bottom"}})}catch(a){const r=a?.response?.data?.message||"發生錯誤，請稍後再試";l({text:r,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom"}})}};Z(async()=>{s.isLogin&&(n.value=await i())});const i=async()=>{try{const{data:a}=await v.get("/users/favorite",{params:{bookId:f._id}});return a.result.includes(f._id)}catch(a){return console.error(a),!1}};return(a,r)=>{const y=xe("RouterLink");return h(),x(be,{class:"books-card hover-card",width:"250px",height:"380px"},{default:o(()=>[e.maturityRating==="MATURE"?(h(),L("div",Ee,r[0]||(r[0]=[c("span",{class:"mature-text"},"18+",-1)]))):z("",!0),t(y,{to:"/books/"+e._id},{default:o(()=>[t(ge,{src:e.image,height:"250px"},null,8,["src"])]),_:1},8,["to"]),t(ye,null,{default:o(()=>[t(y,{class:"text-primary text-decoration-none",to:"/books/"+e._id,title:e.title,style:{fontWeight:"bold"}},{default:o(()=>[b(C(e.title),1)]),_:1},8,["to","title"])]),_:1}),t(B,{class:"justify-space-between"},{default:o(()=>[t(p,{cols:"6"},{default:o(()=>[t(N,{class:"text-left",style:{width:"170px"},title:e.authors},{default:o(()=>[b(C(e.authors),1)]),_:1},8,["title"])]),_:1}),t(p,{class:"text-right",cols:"6"},{default:o(()=>[t(N,null,{default:o(()=>[r[1]||(r[1]=b("$",-1)),c("span",Oe,C(e.retailPrice),1)]),_:1,__:[1]})]),_:1})]),_:1}),t(_e,null,{default:o(()=>[t(B,{class:"justify-center align-center"},{default:o(()=>[t(p,{cols:"6"},{default:o(()=>[t(U,{class:"btn","prepend-icon":n.value?V(Re):V(Ie),color:n.value?"red":"blue",onClick:g},{default:o(()=>[b(C(n.value?"取消最愛":"加入最愛"),1)]),_:1},8,["prepend-icon","color"])]),_:1}),t(p,{cols:"6"},{default:o(()=>[t(U,{class:"btn",color:"primary","prepend-icon":V(Ae),onClick:d},{default:o(()=>r[2]||(r[2]=[b("加入購物車",-1)])),_:1,__:[2]},8,["prepend-icon"])]),_:1})]),_:1})]),_:1})]),_:1})}}},qe=O(We,[["__scopeId","data-v-1f089073"]]),Ge={class:"adult-switch-container mt-5 d-flex align-center"},Ze={class:"switch-indicators ml-2"},Je={key:1,class:"adult-badge"},Ke={__name:"HomeView",setup(e){const{api:v}=q(),f=W(),s=k([]),n=k(""),l=k(!1),u=k(!1),g=async()=>{try{u.value=!1;const{data:d}=await v.get("/books",{params:{search:n.value}}),i=d.result.data.reduce((a,r)=>((l.value||r.maturityRating==="NOT_MATURE")&&a.push(r),a),[]);s.value=i,await Se(),setTimeout(()=>{u.value=!0},100)}catch(d){console.log(d);const i=d?.response?.data?.message||"發生錯誤，請稍後再試";f({text:i,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom"}})}};return Z(()=>{g()}),Be([n,l],g),(d,i)=>(h(),x(Le,null,{default:o(()=>[t(B,null,{default:o(()=>[t(p,{cols:"10",md:"11"},{default:o(()=>[t(Ve,{class:"mx-auto mt-5","menu-icon":"",placeholder:"請輸入書籍名稱","prepend-inner-icon":V(Fe),modelValue:n.value,"onUpdate:modelValue":i[0]||(i[0]=a=>n.value=a)},null,8,["prepend-inner-icon","modelValue"])]),_:1}),t(p,{class:"d-flex mt-2 justify-end",cols:"2",md:"1"},{default:o(()=>[c("div",Ge,[t($e,{class:"adult-switch",modelValue:l.value,"onUpdate:modelValue":i[1]||(i[1]=a=>l.value=a),color:l.value?"red":"green","hide-details":"",density:"compact"},null,8,["modelValue","color"]),c("div",Ze,[l.value?z("",!0):(h(),x(E,{key:0,color:"green",size:"small",icon:V(Te)},null,8,["icon"])),l.value?(h(),L("div",Je,i[2]||(i[2]=[c("span",{class:"adult-text"},"18+",-1)]))):z("",!0)])])]),_:1})]),_:1}),t(B,null,{default:o(()=>[(h(!0),L(G,null,Pe(s.value,(a,r)=>(h(),x(p,{class:"d-flex justify-center",cols:"12",md:"4",xl:"2",key:a._id},{default:o(()=>[c("div",{class:T(["book-wrapper",{"animate-in":u.value}]),style:F({animationDelay:`${r*.1}s`})},[t(qe,A({ref_for:!0},a),null,16)],6)]),_:2},1024))),128))]),_:1})]),_:1}))}},lt=O(Ke,[["__scopeId","data-v-cb873542"]]);export{lt as default};
