import{p as ae,g as te,o as A,t as f,aL as le,q as oe,u as se,c as o,a0 as re,G,U as ue,x as g,Z as ne,_ as r,a3 as de,as as k,az as ie,V as me,a8 as D,a7 as T,aw as ce,ap as pe,am as ge,ay as ve,ao as be,a9 as Ve,ac as fe}from"./index-80f81ebd.js";import{V as ye}from"./VContainer-1c22de85.js";import{V as Pe}from"./VCol-12a37a56.js";import{m as ke,a as he,b as xe,c as we,d as Te,e as Se,f as Be,u as Ce,p as De,g as Ie,h as Ue,i as _e,j as qe,k as Fe,l as Ae,n as O,o as K,q as j,r as z}from"./VDataTable-a74d9d25.js";import{V as Ge}from"./VForm-4ac63ff6.js";import{V as Le}from"./VTextarea-b2b6c5c5.js";import{V as Re}from"./VRow-0a078d97.js";import"./VList-45bd9ae0.js";import"./VDivider-3bf593a5.js";import"./VSelectionControl-ab995a3c.js";const Ee=ae({itemsLength:{type:[Number,String],required:!0},...ke(),...he(),...xe()},"VDataTableServer"),He=te()({name:"VDataTableServer",props:Ee(),emits:{"update:modelValue":l=>!0,"update:page":l=>!0,"update:itemsPerPage":l=>!0,"update:sortBy":l=>!0,"update:options":l=>!0,"update:expanded":l=>!0,"update:groupBy":l=>!0},setup(l,h){let{attrs:b,slots:a}=h;const{groupBy:p}=we(l),{sortBy:m,multiSort:x,mustSort:I}=Te(l),{page:v,itemsPerPage:y}=Se(l),P=A(()=>parseInt(l.itemsLength,10)),{columns:V,headers:s}=Be(l,{groupBy:p,showSelect:f(l,"showSelect"),showExpand:f(l,"showExpand")}),{items:d}=Ce(l,V),{toggleSort:S}=De({sortBy:m,multiSort:x,mustSort:I,page:v}),{opened:B,isGroupOpen:U,toggleGroup:C,extractRows:_}=Ie({groupBy:p,sortBy:m}),{pageCount:u,setItemsPerPage:t}=Ue({page:v,itemsPerPage:y,itemsLength:P}),{flatItems:e}=_e(d,p,B),{isSelected:n,select:i,selectAll:q,toggleSelect:W,someSelected:Z,allSelected:J}=qe(l,{allItems:d,currentPage:d}),{isExpanded:M,toggleExpand:Q}=Fe(l),L=A(()=>_(d.value));Ae({page:v,itemsPerPage:y,sortBy:m,groupBy:p,search:f(l,"search")}),le("v-data-table",{toggleSort:S,sortBy:m}),oe({VDataTableRows:{hideNoData:f(l,"hideNoData"),noDataText:f(l,"noDataText"),loading:f(l,"loading"),loadingText:f(l,"loadingText")}});const c=A(()=>({page:v.value,itemsPerPage:y.value,sortBy:m.value,pageCount:u.value,toggleSort:S,setItemsPerPage:t,someSelected:Z.value,allSelected:J.value,isSelected:n,select:i,selectAll:q,toggleSelect:W,isExpanded:M,toggleExpand:Q,isGroupOpen:U,toggleGroup:C,items:L.value.map(F=>F.raw),internalItems:L.value,groupedItems:e.value,columns:V.value,headers:s.value}));se(()=>{const F=O.filterProps(l),X=K.filterProps(l),Y=j.filterProps(l),ee=z.filterProps(l);return o(z,G({class:["v-data-table",{"v-data-table--loading":l.loading},l.class],style:l.style},ee),{top:()=>{var w;return(w=a.top)==null?void 0:w.call(a,c.value)},default:()=>{var w,R,E,H,N,$;return a.default?a.default(c.value):o(re,null,[(w=a.colgroup)==null?void 0:w.call(a,c.value),o("thead",{class:"v-data-table__thead",role:"rowgroup"},[o(K,G(X,{sticky:l.fixedHeader}),a)]),(R=a.thead)==null?void 0:R.call(a,c.value),o("tbody",{class:"v-data-table__tbody",role:"rowgroup"},[(E=a["body.prepend"])==null?void 0:E.call(a,c.value),a.body?a.body(c.value):o(j,G(b,Y,{items:e.value}),a),(H=a["body.append"])==null?void 0:H.call(a,c.value)]),(N=a.tbody)==null?void 0:N.call(a,c.value),($=a.tfoot)==null?void 0:$.call(a,c.value)])},bottom:()=>a.bottom?a.bottom(c.value):o(O,F,{prepend:a["footer.prepend"]})})})}}),Qe={__name:"BookmanagementView",setup(l){const{apiAuth:h}=fe(),b=ue(),a=g(10),p=g([{key:"createdAt",order:"desc"}]),m=g(1),x=g([]),I=[{title:"圖片",align:"center",sortable:!1,key:"image"},{title:"書名",align:"center",sortable:!0,key:"title"},{title:"作者",align:"center",sortable:!0,key:"authors"},{title:"出版者",align:"center",sortable:!0,key:"publisher"},{title:"價格",align:"center",sortable:!0,key:"retailPrice"},{title:"分類",align:"center",sortable:!0,key:"categories"},{title:"編輯",align:"center",sortable:!1,key:"edit"},{title:"刪除",align:"center",sortable:!1,key:"delete"}],v=g(!0),y=g(0),P=g(""),V=g(!1),s=g({_id:"",title:"",authors:"",publisher:"",retailPrice:"",categories:"",description:""}),d=async()=>{var u,t,e,n;v.value=!0;try{const{data:i}=await h.get("/books/all",{params:{page:m.value,itemsPerPage:a.value,sortBy:((u=p.value[0])==null?void 0:u.key)||"createdAt",sortOrder:((t=p.value[0])==null?void 0:t.order)==="asc"?1:-1,search:P.value}});x.value.splice(0,x.value.length,...i.result.data),y.value=i.result.total}catch(i){console.log(i);const q=((n=(e=i==null?void 0:i.response)==null?void 0:e.data)==null?void 0:n.message)||"發生錯誤，請稍後再試";b({text:q,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom"}})}v.value=!1};d();const S=async u=>{var t,e;if(console.log(u),!u._id){console.error("沒有書籍 ID");return}try{await h.delete(`/books/${u._id}`),b({text:"書籍已成功刪除",showCloseButton:!1,snackbarProps:{timeout:2e3,color:"green",location:"bottom"}}),d()}catch(n){console.log(n);const i=((e=(t=n==null?void 0:n.response)==null?void 0:t.data)==null?void 0:e.message)||"刪除書籍時發生錯誤，請稍後再試";b({text:i,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom"}})}},B=()=>{m.value=1,d()},U=u=>{s.value={...u},V.value=!0},C=()=>{V.value=!1},_=async()=>{var u,t;try{await h.patch(`/books/${s.value._id}`,s.value),b({text:"書籍已成功更新",showCloseButton:!1,snackbarProps:{timeout:2e3,color:"green",location:"bottom"}}),d(),C()}catch(e){console.log(e);const n=((t=(u=e==null?void 0:e.response)==null?void 0:u.data)==null?void 0:t.message)||"更新書籍時發生錯誤，請稍後再試";b({text:n,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom"}})}};return(u,t)=>(de(),ne(ye,null,{default:r(()=>[o(Re,null,{default:r(()=>[o(Pe,{cols:"12"},{default:r(()=>[o(He,{"items-per-page":a.value,"onUpdate:itemsPerPage":[t[1]||(t[1]=e=>a.value=e),d],"sort-by":p.value,"onUpdate:sortBy":[t[2]||(t[2]=e=>p.value=e),d],page:m.value,"onUpdate:page":[t[3]||(t[3]=e=>m.value=e),d],items:x.value,headers:I,loading:v.value,"items-length":y.value,search:P.value,hover:""},{top:r(()=>[o(k,{label:"搜尋","append-icon":"mdi-magnify",modelValue:P.value,"onUpdate:modelValue":t[0]||(t[0]=e=>P.value=e),"onClick:append":B,onKeydown:ie(B,["enter"])},null,8,["modelValue"])]),"item.image":r(({item:e})=>[o(me,{src:e.image},null,8,["src"])]),"item.edit":r(({item:e})=>[o(D,{onClick:n=>U(e)},{default:r(()=>[T("編輯")]),_:2},1032,["onClick"])]),"item.delete":r(({item:e})=>[o(D,{onClick:n=>S(e)},{default:r(()=>[T("刪除")]),_:2},1032,["onClick"])]),_:2},1032,["items-per-page","sort-by","page","items","loading","items-length","search"]),o(ce,{modelValue:V.value,"onUpdate:modelValue":t[10]||(t[10]=e=>V.value=e),persistent:"","max-width":"600px"},{default:r(()=>[o(pe,null,{default:r(()=>[o(ge,null,{default:r(()=>[T("編輯書籍")]),_:1}),o(ve,null,{default:r(()=>[o(Ge,{ref:"editForm"},{default:r(()=>[o(k,{modelValue:s.value.title,"onUpdate:modelValue":t[4]||(t[4]=e=>s.value.title=e),label:"書名",required:""},null,8,["modelValue"]),o(k,{modelValue:s.value.authors,"onUpdate:modelValue":t[5]||(t[5]=e=>s.value.authors=e),label:"作者",required:""},null,8,["modelValue"]),o(k,{modelValue:s.value.publisher,"onUpdate:modelValue":t[6]||(t[6]=e=>s.value.publisher=e),label:"出版者",required:""},null,8,["modelValue"]),o(k,{modelValue:s.value.retailPrice,"onUpdate:modelValue":t[7]||(t[7]=e=>s.value.retailPrice=e),label:"價格",required:"",type:"number"},null,8,["modelValue"]),o(k,{modelValue:s.value.categories,"onUpdate:modelValue":t[8]||(t[8]=e=>s.value.categories=e),label:"分類",required:""},null,8,["modelValue"]),o(Le,{modelValue:s.value.description,"onUpdate:modelValue":t[9]||(t[9]=e=>s.value.description=e),label:"簡介",rows:"5"},null,8,["modelValue"])]),_:1},512)]),_:1}),o(be,null,{default:r(()=>[o(Ve),o(D,{color:"blue darken-1",text:"",onClick:C},{default:r(()=>[T("取消")]),_:1}),o(D,{color:"blue darken-1",text:"",onClick:_},{default:r(()=>[T("保存")]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}))}};export{Qe as default};
