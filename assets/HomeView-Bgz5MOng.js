import{_ as R,u as F,a as S}from"./index-Mk3cYYfI.js";import{r as v,J as P,R as L,k as T,E as A,D as b,F as d,G as t,L as x,M as w,H as e,a5 as g,a6 as I,a7 as U,Y as h,Z as k,a8 as y,a9 as m,aa as C,ab as N,a1 as B,ac as $,w as j,a0 as E,n as M,ad as H,ae as W,$ as z,Q as D,U as q,af as G}from"./vue-vendor-DZ6ShR-l.js";import{g as J}from"./vendor-fvIX-KvJ.js";const O={key:0,class:"mature-badge"},Q={style:{fontSize:"1.5em",color:"#750000",fontWeight:"bold"}},Y={__name:"BooksCard",props:["_id","title","authors","publisher","retailPrice","categories","description","image","maturityRating"],setup(r){const{apiAuth:_}=S(),f=r,i=F(),s=v(!1),l=P(),p=L(),u=async()=>{if(!i.isLogin){p.push("/login");return}s.value=!s.value;try{const{data:a}=await _.post("/users/favorite",{bookId:f._id,isFavorite:s.value});console.log(a),i.favorite=a.result,s.value?l({text:"已加入我的最愛",showCloseButton:!1,snackbarProps:{timeout:2e3,color:"green",location:"bottom"}}):l({text:"已移除我的最愛",showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom"}})}catch(a){a.response&&a.response.status===401?p.push("/login"):(console.error(a),l({text:"發生錯誤，請稍後再試",showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom"}}))}},o=async()=>{if(!i.isLogin){p.push("/login");return}try{const{data:a}=await _.patch("/users/cart",{book:f._id,quantity:1});i.cart=a.result,l({text:"新增成功",showCloseButton:!1,snackbarProps:{timeout:2e3,color:"green",location:"bottom"}})}catch(a){const c=a?.response?.data?.message||"發生錯誤，請稍後再試";l({text:c,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom"}})}};T(async()=>{i.isLogin&&(s.value=await n())});const n=async()=>{try{const{data:a}=await _.get("/users/favorite",{params:{bookId:f._id}});return a.result.includes(f._id)}catch(a){return console.error(a),!1}};return(a,c)=>{const V=A("RouterLink");return d(),b($,{class:"books-card hover-card",width:"250px",height:"380px"},{default:t(()=>[r.maturityRating==="MATURE"?(d(),x("div",O,c[0]||(c[0]=[g("span",{class:"mature-text"},"18+",-1)]))):w("",!0),e(V,{to:"/books/"+r._id},{default:t(()=>[e(I,{src:r.image,height:"250px"},null,8,["src"])]),_:1},8,["to"]),e(U,null,{default:t(()=>[e(V,{class:"text-primary text-decoration-none",to:"/books/"+r._id,title:r.title,style:{fontWeight:"bold"}},{default:t(()=>[h(k(r.title),1)]),_:1},8,["to","title"])]),_:1}),e(y,{class:"justify-space-between"},{default:t(()=>[e(m,{cols:"6"},{default:t(()=>[e(C,{class:"text-left",style:{width:"170px"},title:r.authors},{default:t(()=>[h(k(r.authors),1)]),_:1},8,["title"])]),_:1}),e(m,{class:"text-right",cols:"6"},{default:t(()=>[e(C,null,{default:t(()=>[c[1]||(c[1]=h("$",-1)),g("span",Q,k(r.retailPrice),1)]),_:1,__:[1]})]),_:1})]),_:1}),e(N,null,{default:t(()=>[e(y,{class:"justify-center align-center"},{default:t(()=>[e(m,{cols:"6"},{default:t(()=>[e(B,{class:"btn","prepend-icon":s.value?"mdi-heart-minus":"mdi-heart-plus",color:s.value?"red":"blue",onClick:u},{default:t(()=>[h(k(s.value?"取消最愛":"加入最愛"),1)]),_:1},8,["prepend-icon","color"])]),_:1}),e(m,{cols:"6"},{default:t(()=>[e(B,{class:"btn",color:"primary","prepend-icon":"mdi-cart",onClick:o},{default:t(()=>c[2]||(c[2]=[h("加入購物車",-1)])),_:1,__:[2]})]),_:1})]),_:1})]),_:1})]),_:1})}}},Z=R(Y,[["__scopeId","data-v-f8410830"]]),K={class:"adult-switch-container mt-5 d-flex align-center"},X={class:"switch-indicators ml-2"},tt={key:1,class:"adult-badge"},et={__name:"HomeView",setup(r){const{api:_}=S(),f=P(),i=v([]),s=v(""),l=v(!1),p=async()=>{try{const{data:u}=await _.get("/books",{params:{search:s.value}}),o=u.result.data.reduce((n,a)=>((l.value||a.maturityRating==="NOT_MATURE")&&n.push(a),n),[]);i.value=o,await M(),J.to(".books-card",{opacity:1,duration:.5})}catch(u){console.log(u);const o=u?.response?.data?.message||"發生錯誤，請稍後再試";f({text:o,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom"}})}};return T(()=>{p()}),j([s,l],p),(u,o)=>(d(),b(E,null,{default:t(()=>[e(y,null,{default:t(()=>[e(m,{cols:"10",md:"11"},{default:t(()=>[e(H,{class:"mx-auto mt-5","menu-icon":"",placeholder:"請輸入書籍名稱","prepend-inner-icon":"mdi-magnify",modelValue:s.value,"onUpdate:modelValue":o[0]||(o[0]=n=>s.value=n)},null,8,["modelValue"])]),_:1}),e(m,{class:"d-flex mt-2 justify-end",cols:"2",md:"1"},{default:t(()=>[g("div",K,[e(W,{class:"adult-switch",modelValue:l.value,"onUpdate:modelValue":o[1]||(o[1]=n=>l.value=n),color:l.value?"red":"green","hide-details":"",density:"compact"},null,8,["modelValue","color"]),g("div",X,[l.value?w("",!0):(d(),b(z,{key:0,color:"green",size:"small"},{default:t(()=>o[2]||(o[2]=[h("mdi-shield-check",-1)])),_:1,__:[2]})),l.value?(d(),x("div",tt,o[3]||(o[3]=[g("span",{class:"adult-text"},"18+",-1)]))):w("",!0)])])]),_:1})]),_:1}),e(y,null,{default:t(()=>[(d(!0),x(D,null,q(i.value,n=>(d(),b(m,{class:"d-flex justify-center",cols:"12",md:"4",xl:"2",key:n._id},{default:t(()=>[e(Z,G({ref_for:!0},n),null,16)]),_:2},1024))),128))]),_:1})]),_:1}))}},lt=R(et,[["__scopeId","data-v-0b0caf27"]]);export{lt as default};
