import{p as Q,m as W,a as X,g as Z,u as O,c as e,al as H,am as Y,an as ee,f as le,ao as te,l as ae,D as ne,o as x,y as oe,ap as se,s as ue,a4 as ie,U as F,J as L,G as re,Z as I,aq as de,K as ce,x as C,L as me,M as ve,A as fe,P as S,Q as A,S as t,ar as ge,a0 as be,V as _e,ak as f,$ as k,R as q,T as he,aj as j,X as T,W as Ve,ac as E,aa as ye,as as ke,at as pe}from"./index-6749de4f.js";import{u as Le,V as G}from"./vee-validate.esm-f69da69e.js";import{V as we}from"./VContainer-2f0c95e8.js";import{V as _,a as c}from"./VRow-add2b8cf.js";import{V as J}from"./VTextarea-5d9d6314.js";import{b as xe,V as Ce,a as Se,c as Ie}from"./VList-e9ab515e.js";import"./VDivider-ab38f83e.js";const Pe=Q({start:Boolean,end:Boolean,...W(),...X()},"VListItemAction"),K=Z()({name:"VListItemAction",props:Pe(),setup(l,w){let{slots:h}=w;return O(()=>e(l.tag,{class:["v-list-item-action",{"v-list-item-action--start":l.start,"v-list-item-action--end":l.end},l.class],style:l.style},h)),{}}});const Be=Q({name:String,itemAriaLabel:{type:String,default:"$vuetify.rating.ariaLabel.item"},activeColor:String,color:String,clearable:Boolean,disabled:Boolean,emptyIcon:{type:H,default:"$ratingEmpty"},fullIcon:{type:H,default:"$ratingFull"},halfIncrements:Boolean,hover:Boolean,length:{type:[Number,String],default:5},readonly:Boolean,modelValue:{type:[Number,String],default:0},itemLabels:Array,itemLabelPosition:{type:String,default:"top",validator:l=>["top","bottom"].includes(l)},ripple:Boolean,...W(),...Y(),...ee(),...X(),...le()},"VRating"),U=Z()({name:"VRating",props:Be(),emits:{"update:modelValue":l=>!0},setup(l,w){let{slots:h}=w;const{t:P}=te(),{themeClasses:B}=ae(l),p=ne(l,"modelValue"),V=x(()=>oe(parseFloat(p.value),0,+l.length)),y=x(()=>se(Number(l.length),1)),$=x(()=>y.value.flatMap(u=>l.halfIncrements?[u-.5,u]:[u])),v=ue(-1),b=x(()=>$.value.map(u=>{const d=l.hover&&v.value>-1,r=V.value>=u,a=v.value>=u,o=(d?a:r)?l.fullIcon:l.emptyIcon,i=l.activeColor??l.color,g=r||a?i:l.color;return{isFilled:r,isHovered:a,icon:o,color:g}})),R=x(()=>[0,...$.value].map(u=>{function d(){v.value=u}function r(){v.value=-1}function a(){l.disabled||l.readonly||(p.value=V.value===u&&l.clearable?0:u)}return{onMouseenter:l.hover?d:void 0,onMouseleave:l.hover?r:void 0,onClick:a}})),s=x(()=>l.name??`v-rating-${ie()}`);function m(u){var z,N;let{value:d,index:r,showStar:a=!0}=u;const{onMouseenter:n,onMouseleave:o,onClick:i}=R.value[r+1],g=`${s.value}-${String(d).replace(".","-")}`,D={color:(z=b.value[r])==null?void 0:z.color,density:l.density,disabled:l.disabled,icon:(N=b.value[r])==null?void 0:N.icon,ripple:l.ripple,size:l.size,variant:"plain"};return e(F,null,[e("label",{for:g,class:{"v-rating__item--half":l.halfIncrements&&d%1>0,"v-rating__item--full":l.halfIncrements&&d%1===0},onMouseenter:n,onMouseleave:o,onClick:i},[e("span",{class:"v-rating__hidden"},[P(l.itemAriaLabel,d,l.length)]),a?h.item?h.item({...b.value[r],props:D,value:d,index:r,rating:V.value}):e(L,re({"aria-label":P(l.itemAriaLabel,d,l.length)},D),null):void 0]),e("input",{class:"v-rating__hidden",name:s.value,id:g,type:"radio",value:d,checked:V.value===d,tabindex:-1,readonly:l.readonly,disabled:l.disabled},null)])}function M(u){return h["item-label"]?h["item-label"](u):u.label?e("span",null,[u.label]):e("span",null,[I(" ")])}return O(()=>{var d;const u=!!((d=l.itemLabels)!=null&&d.length)||h["item-label"];return e(l.tag,{class:["v-rating",{"v-rating--hover":l.hover,"v-rating--readonly":l.readonly},B.value,l.class],style:l.style},{default:()=>[e(m,{value:0,index:-1,showStar:!1},null),y.value.map((r,a)=>{var n,o;return e("div",{class:"v-rating__wrapper"},[u&&l.itemLabelPosition==="top"?M({value:r,index:a,label:(n=l.itemLabels)==null?void 0:n[a]}):void 0,e("div",{class:"v-rating__item"},[l.halfIncrements?e(F,null,[e(m,{value:r-.5,index:a*2},null),e(m,{value:r,index:a*2+1},null)]):e(m,{value:r,index:a},null)]),u&&l.itemLabelPosition==="bottom"?M({value:r,index:a,label:(o=l.itemLabels)==null?void 0:o[a]}):void 0])})]})}),{}}}),$e=f("h3",null,"出版者:",-1),Re=f("h3",null,"價格:",-1),Me=f("h3",null,"分類:",-1),Ae=f("h3",null,"簡介:",-1),Fe=["innerHTML"],Te={key:1},Ue=f("h3",null,"新增書評:",-1),De=f("h3",null,"書評:",-1),ze=f("h3",null,"編輯書評",-1),Ke={__name:"BookView",setup(l){const w=de(),h=ce(),{api:P,apiAuth:B}=be(),p=C(!1),V=C(!1),y=me(),$=ve(),v=C({usersId:"",rating:0,comment:""}),b=C(!1),{handleSubmit:R}=Le({initialValues:{usersId:"",rating:0,comment:""}}),s=C({_id:"",image:"",title:"",authors:"",publisher:"",retailPrice:"",categories:"",buyLink:"",description:"",reviews:[]}),m=C([]),M=()=>{b.value=!1},u=R(async a=>{var n,o;if(console.log(v.value),!$.isLogin){h.push("/login"),y({text:"請先登入",showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom"}});return}try{const{data:i}=await B.post(`/books/${w.params.id}/reviews`,{rating:v.value.rating,conmment:v.value.comment});i&&i.result&&s.value.reviews.push(i.result),y({text:"新增成功",showCloseButton:!1,snackbarProps:{timeout:2e3,color:"green",location:"bottom"}})}catch(i){console.log(i);const g=((o=(n=i==null?void 0:i.response)==null?void 0:n.data)==null?void 0:o.message)||"發生錯誤，請稍後再試";y({text:g,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom"}})}}),d=a=>{if(a){const n=s.value.reviews.find(o=>o._id===a);console.log(n),m.value.id=n._id,m.value.rating=n.rating,m.value.comment=n.comment}b.value=!0},r=R(async a=>{var n,o;console.log(m.value);try{const i=new FormData;for(const g in a)i.append(g,a[g]);b.value===""&&await B.patch("/books/"+b.value,i),y({text:"編輯成功",showCloseButton:!1,snackbarProps:{timeout:2e3,color:"green",location:"bottom"}})}catch(i){console.log(i);const g=((o=(n=i==null?void 0:i.response)==null?void 0:n.data)==null?void 0:o.message)||"發生錯誤，請稍後再試";y({text:g,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom"}})}M()});return fe(async()=>{try{const{data:a}=await P.get(`/books/${w.params.id}`);s.value._id=a.result._id,s.value.image=a.result.image,s.value.title=a.result.title,s.value.authors=a.result.authors,s.value.publisher=a.result.publisher,s.value.retailPrice=a.result.retailPrice,s.value.categories=a.result.categories,s.value.buyLink=a.result.buyLink;let n=a.result.description.replace(/(※|★|◆|【)/g,"<br>$1");n=n.replace(/(】)/g,"$1<br>"),n=n.replace(new RegExp("(?<=──[^,]*?)(?=,)","g"),"<br>$1"),s.value.description=n,s.value.reviews=a.result.reviews,document.title=`書評網 | ${s.value.title}`}catch(a){console.log(a)}}),(a,n)=>(S(),A(F,null,[e(we,null,{default:t(()=>[e(_,null,{default:t(()=>[e(c,{cols:"12",md:"3",style:{position:"sticky"},top:"0"},{default:t(()=>[e(_e,{src:s.value.image},null,8,["src"]),e(c,{class:"d-flex justify-space-between"},{default:t(()=>[e(L,{class:"mt-5",color:"#4d4637",dark:"",href:s.value.buyLink,target:"_blank"},{default:t(()=>[I("購買介面")]),_:1},8,["href"]),e(L,{class:"mt-3",icon:"mdi-heart-plus"})]),_:1})]),_:1}),e(c,{cols:"12",md:"9"},{default:t(()=>[f("h1",null,k(s.value.title),1),f("h2",null,k(s.value.authors),1),e(_,null,{default:t(()=>[e(c,{cols:"auto"},{default:t(()=>[$e]),_:1}),e(c,null,{default:t(()=>[f("p",null,k(s.value.publisher),1)]),_:1})]),_:1}),e(_,null,{default:t(()=>[e(c,{cols:"auto"},{default:t(()=>[Re]),_:1}),e(c,null,{default:t(()=>[f("p",null,"$"+k(s.value.retailPrice),1)]),_:1})]),_:1}),e(_,null,{default:t(()=>[e(c,{cols:"auto"},{default:t(()=>[Me]),_:1}),e(c,null,{default:t(()=>[f("p",null,k(s.value.categories),1)]),_:1})]),_:1}),e(_,null,{default:t(()=>[e(c,{cols:"auto"},{default:t(()=>[Ae,V.value?(S(),A("p",{key:0,innerHTML:s.value.description},null,8,Fe)):(S(),A("p",Te,k(s.value.description.substring(0,500)),1))]),_:1}),e(c,{class:"text-center"},{default:t(()=>[s.value.description.length>100?(S(),q(L,{key:0,color:"#4d4637",onClick:n[0]||(n[0]=o=>V.value=!V.value),icon:V.value?"mdi-chevron-up":"mdi-chevron-down"},null,8,["icon"])):he("",!0)]),_:1})]),_:1}),e(_,null,{default:t(()=>[e(c,{cols:"12"},{default:t(()=>[Ue,e(G,{disabled:p.value,onSubmit:j(T(u),["prevent"])},{default:t(()=>[e(U,{modelValue:v.value.rating,"onUpdate:modelValue":n[1]||(n[1]=o=>v.value.rating=o),color:"#4d4637 darken-3",hover:""},null,8,["modelValue"]),e(J,{modelValue:v.value.comment,"onUpdate:modelValue":n[2]||(n[2]=o=>v.value.comment=o),label:"你的書評",required:""},null,8,["modelValue"]),e(L,{color:"#4d4637",type:"submit",loading:p.value},{default:t(()=>[I("提交")]),_:1},8,["loading"])]),_:1},8,["disabled","onSubmit"])]),_:1})]),_:1}),e(_,null,{default:t(()=>[e(c,{cols:"12"},{default:t(()=>[De,e(xe,null,{default:t(()=>[(S(!0),A(F,null,Ve(s.value.reviews,o=>(S(),q(Ce,{key:o._id},{default:t(()=>[e(E,null,{default:t(()=>[e(_,null,{default:t(()=>[e(c,{cols:"auto"},{default:t(()=>[e(Se,{style:{fontSize:"30px"}},{default:t(()=>[I(k(o.user.account),1)]),_:2},1024)]),_:2},1024),e(c,{cols:"auto"},{default:t(()=>[e(K,null,{default:t(()=>[e(U,{modelValue:o.rating,"onUpdate:modelValue":i=>o.rating=i,color:"#4d4637 darken-3",size:"25",readonly:""},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024)]),_:2},1024),e(_,null,{default:t(()=>[e(c,null,{default:t(()=>[e(Ie,{class:"mb-5",style:{fontSize:"20px"}},{default:t(()=>[I(k(o.comment),1)]),_:2},1024)]),_:2},1024)]),_:2},1024),e(_,null,{default:t(()=>[e(c,{cols:"auto"},{default:t(()=>[e(K,null,{default:t(()=>[e(L,{icon:"mdi-pencil",color:"#4d4637",onClick:()=>d(o._id)},null,8,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),e(ge,{modelValue:b.value,"onUpdate:modelValue":n[6]||(n[6]=o=>b.value=o),"max-width":"290"},{default:t(()=>[e(G,{disabled:p.value,onSubmit:j(T(u),["prevent"])},{default:t(()=>[e(E,null,{default:t(()=>[e(ye,null,{default:t(()=>[ze]),_:1}),e(ke,null,{default:t(()=>[e(U,{modelValue:m.value.rating,"onUpdate:modelValue":n[3]||(n[3]=o=>m.value.rating=o),color:"#4d4637 darken-3",hover:""},null,8,["modelValue"]),e(J,{modelValue:m.value.comment,"onUpdate:modelValue":n[4]||(n[4]=o=>m.value.comment=o),label:"你的書評",required:""},null,8,["modelValue"])]),_:1}),e(pe,null,{default:t(()=>[e(L,{color:"#4d4637",onClick:n[5]||(n[5]=o=>T(r)(a.review)),loading:p.value},{default:t(()=>[I("修正")]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["disabled","onSubmit"])]),_:1},8,["modelValue"])],64))}};export{Ke as default};
