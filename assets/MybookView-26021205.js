import{Z as A,Y as x,x as o,a0 as C,a2 as I,a3 as l,c as n,as as S,az as U,V as _,a7 as $,ab as z}from"./index-36b314a2.js";import{V as L}from"./VContainer-ab880846.js";import{V as T}from"./VCol-306208bc.js";import{V as D}from"./VDataTable-c0402884.js";import{V as H}from"./VRating-57ef7123.js";import{V as K}from"./VRow-9ed4fb13.js";import"https://s900207.github.io/book-front/assets/materialdesignicons-webfont-61e8aba5.ttf";import"https://s900207.github.io/book-front/assets/materialdesignicons-webfont-a5928a0d.woff";import"https://s900207.github.io/book-front/assets/materialdesignicons-webfont-662fefa8.woff2";import"./VList-a8dd1efc.js";import"./VDivider-8b5600f2.js";import"./VSelectionControl-f579600c.js";const w=55,ee={__name:"MybookView",setup(M){const{apiAuth:f}=z(),g=A(),P=x(),d=o(10),u=o([{key:"createdAt",order:"desc"}]),c=o(1),m=o([]);console.log(m.value);const B=[{title:"圖片",align:"center",sortable:!1,key:"image",value:a=>a.result.image},{title:"書名",align:"center",sortable:!0,key:"result.title"},{title:"作者",align:"center",sortable:!0,key:"result.authors"},{title:"出版者",align:"center",sortable:!0,key:"result.publisher"},{title:"分類",align:"center",sortable:!0,key:"result.categories"},{title:"評分(1-5)",align:"center",sortable:!0,key:"result.rating",value:a=>{const t=a.result.reviews.find(e=>e.user.$oid===g.value);return t?t.rating:"未提供評分"},cellTemplate:a=>`<v-rating :value="${a}" readonly color="#4d4637 darken-3" size="20"></v-rating>`},{title:"書評",align:"center",sortable:!1,key:"result.review",value:a=>{const t=a.result.reviews.find(e=>e.user.$oid===g.value);if(t){const e=t.comment,s=[];for(let r=0;r<e.length;r+=w)s.push(e.substring(r,r+w));return s.join(`
`)}else return"未提供書評"}}],v=o(!0),k=o(0),p=o(""),i=async()=>{var a,t;v.value=!0;try{const{data:e}=await f.get("/users/favorite");console.log(e);const r=e.result.map(b=>{var V,h;return f.get(`/books/${b}`,{params:{page:c.value,itemsPerPage:d.value,sortBy:((V=u.value[0])==null?void 0:V.key)||"createdAt",sortOrder:((h=u.value[0])==null?void 0:h.order)==="asc"?1:-1,search:p.value}})}),R=(await Promise.all(r)).map(b=>b.data);m.value.splice(0,m.value.length,...R),k.value=e.result.length}catch(e){console.log(e);const s=((t=(a=e==null?void 0:e.response)==null?void 0:a.data)==null?void 0:t.message)||"發生錯誤，請稍後再試";P({text:s,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom"}})}v.value=!1};i();const y=()=>{c.value=1,i()};return(a,t)=>(C(),I(L,null,{default:l(()=>[n(K,null,{default:l(()=>[n(T,{cols:"12"},{default:l(()=>[n(D,{"items-per-page":d.value,"onUpdate:itemsPerPage":[t[1]||(t[1]=e=>d.value=e),i],"sort-by":u.value,"onUpdate:sortBy":[t[2]||(t[2]=e=>u.value=e),i],page:c.value,"onUpdate:page":[t[3]||(t[3]=e=>c.value=e),i],items:m.value,headers:B,loading:v.value,"items-length":k.value,search:p.value,hover:""},{top:l(()=>[n(S,{label:"搜尋","append-icon":"mdi-magnify",modelValue:p.value,"onUpdate:modelValue":t[0]||(t[0]=e=>p.value=e),"onClick:append":y,onKeydown:U(y,["enter"])},null,8,["modelValue"])]),"item.image":l(({item:e})=>[n(_,{src:e.result.image},null,8,["src"])]),"item.starRating":l(({item:e})=>{var s;return[n(H,{value:((s=e.result.reviews.find(r=>r.user.$oid===$(g).value))==null?void 0:s.rating)||0,readonly:"",color:"#4d4637 darken-3",size:"20"},null,8,["value"])]}),_:2},1032,["items-per-page","sort-by","page","items","loading","items-length","search"])]),_:1})]),_:1})]),_:1}))}};export{ee as default};
