var v=(a,m,r)=>new Promise((d,c)=>{var n=l=>{try{u(r.next(l))}catch(o){c(o)}},_=l=>{try{u(r.throw(l))}catch(o){c(o)}},u=l=>l.done?d(l.value):Promise.resolve(l.value).then(n,_);u((r=r.apply(a,m)).next())});import{_ as I,u as L,a as R}from"./index-183e0965.js";import{r as y,O as P,X as j,k as T,E as H,F as f,G as x,H as e,K as V,R as C,I as t,a9 as N,aa as U,a0 as g,a8 as k,ab as w,ac as p,ad as B,M as b,ae as E,a3 as S,af as M,ag as F,ah as $,w as W,a2 as z,n as O,ai as q,aj as D,_ as G,Y as K,W as X,ak as Y,al as J}from"./vue-vendor-5ccff89c.js";import{g as Q}from"./vendor-913c4e2a.js";const Z=a=>(F("data-v-e5b84d28"),a=a(),$(),a),ee={key:0,class:"mature-badge"},te=Z(()=>b("span",{class:"mature-text"},"18+",-1)),ae=[te],oe={style:{fontSize:"1.5em",color:"#750000",fontWeight:"bold"}},se={__name:"BooksCard",props:["_id","title","authors","publisher","retailPrice","categories","description","image","maturityRating"],setup(a){const{apiAuth:m}=R(),r=a,d=L(),c=y(!1),n=P(),_=j(),u=()=>v(this,null,function*(){if(!d.isLogin){_.push("/login");return}c.value=!c.value;try{const{data:s}=yield m.post("/users/favorite",{bookId:r._id,isFavorite:c.value});console.log(s),d.favorite=s.result,c.value?n({text:"已加入我的最愛",showCloseButton:!1,snackbarProps:{timeout:2e3,color:"green",location:"bottom"}}):n({text:"已移除我的最愛",showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom"}})}catch(s){s.response&&s.response.status===401?_.push("/login"):(console.error(s),n({text:"發生錯誤，請稍後再試",showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom"}}))}}),l=()=>v(this,null,function*(){var s,h;if(!d.isLogin){_.push("/login");return}try{const{data:i}=yield m.patch("/users/cart",{book:r._id,quantity:1});d.cart=i.result,n({text:"新增成功",showCloseButton:!1,snackbarProps:{timeout:2e3,color:"green",location:"bottom"}})}catch(i){const A=((h=(s=i==null?void 0:i.response)==null?void 0:s.data)==null?void 0:h.message)||"發生錯誤，請稍後再試";n({text:A,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom"}})}});T(()=>v(this,null,function*(){d.isLogin&&(c.value=yield o())}));const o=()=>v(this,null,function*(){try{const{data:s}=yield m.get("/users/favorite",{params:{bookId:r._id}});return s.result.includes(r._id)}catch(s){return console.error(s),!1}});return(s,h)=>{const i=H("RouterLink");return f(),x(M,{class:"books-card hover-card",width:"250px",height:"370px"},{default:e(()=>[a.maturityRating==="MATURE"?(f(),V("div",ee,ae)):C("",!0),t(i,{to:"/books/"+a._id},{default:e(()=>[t(N,{src:a.image,height:"250px"},null,8,["src"])]),_:1},8,["to"]),t(U,null,{default:e(()=>[t(i,{class:"text-primary text-decoration-none",to:"/books/"+a._id,title:a.title,style:{fontWeight:"bold"}},{default:e(()=>[g(k(a.title),1)]),_:1},8,["to","title"])]),_:1}),t(w,{class:"justify-space-between"},{default:e(()=>[t(p,{cols:"6"},{default:e(()=>[t(B,{class:"text-left",style:{width:"170px"},title:a.authors},{default:e(()=>[g(k(a.authors),1)]),_:1},8,["title"])]),_:1}),t(p,{class:"text-right",cols:"6"},{default:e(()=>[t(B,null,{default:e(()=>[g("$"),b("span",oe,k(a.retailPrice),1)]),_:1})]),_:1})]),_:1}),t(E,null,{default:e(()=>[t(w,{class:"justify-center align-center"},{default:e(()=>[t(p,{cols:"6"},{default:e(()=>[t(S,{class:"btn","prepend-icon":c.value?"mdi-heart-minus":"mdi-heart-plus",color:c.value?"red":"blue",onClick:u},{default:e(()=>[g(k(c.value?"取消最愛":"加入最愛"),1)]),_:1},8,["prepend-icon","color"])]),_:1}),t(p,{cols:"6"},{default:e(()=>[t(S,{class:"btn",color:"primary","prepend-icon":"mdi-cart",onClick:l},{default:e(()=>[g("加入購物車")]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})}}},le=I(se,[["__scopeId","data-v-e5b84d28"]]);const ce=a=>(F("data-v-0b0caf27"),a=a(),$(),a),ne={class:"adult-switch-container mt-5 d-flex align-center"},re={class:"switch-indicators ml-2"},ie={key:1,class:"adult-badge"},de=ce(()=>b("span",{class:"adult-text"},"18+",-1)),ue=[de],_e={__name:"HomeView",setup(a){const{api:m}=R(),r=P(),d=y([]),c=y(""),n=y(!1),_=()=>v(this,null,function*(){var u,l;try{const{data:o}=yield m.get("/books",{params:{search:c.value}}),s=o.result.data.reduce((h,i)=>((n.value||i.maturityRating==="NOT_MATURE")&&h.push(i),h),[]);d.value=s,yield O(),Q.to(".books-card",{opacity:1,duration:.5})}catch(o){console.log(o);const s=((l=(u=o==null?void 0:o.response)==null?void 0:u.data)==null?void 0:l.message)||"發生錯誤，請稍後再試";r({text:s,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom"}})}});return T(()=>{_()}),W([c,n],_),(u,l)=>(f(),x(z,null,{default:e(()=>[t(w,null,{default:e(()=>[t(p,{cols:"10",md:"11"},{default:e(()=>[t(q,{class:"mx-auto mt-5","menu-icon":"",placeholder:"請輸入書籍名稱","prepend-inner-icon":"mdi-magnify",modelValue:c.value,"onUpdate:modelValue":l[0]||(l[0]=o=>c.value=o)},null,8,["modelValue"])]),_:1}),t(p,{class:"d-flex mt-2 justify-end",cols:"2",md:"1"},{default:e(()=>[b("div",ne,[t(D,{class:"adult-switch",modelValue:n.value,"onUpdate:modelValue":l[1]||(l[1]=o=>n.value=o),color:n.value?"red":"green","hide-details":"",density:"compact"},null,8,["modelValue","color"]),b("div",re,[n.value?C("",!0):(f(),x(G,{key:0,color:"green",size:"small"},{default:e(()=>[g("mdi-shield-check")]),_:1})),n.value?(f(),V("div",ie,ue)):C("",!0)])])]),_:1})]),_:1}),t(w,null,{default:e(()=>[(f(!0),V(X,null,K(d.value,o=>(f(),x(p,{class:"d-flex justify-center",cols:"12",md:"4",xl:"2",key:o._id},{default:e(()=>[t(le,Y(J(o)),null,16)]),_:2},1024))),128))]),_:1})]),_:1}))}},ve=I(_e,[["__scopeId","data-v-0b0caf27"]]);export{ve as default};
