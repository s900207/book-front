import{U as q,W as I,x as h,o as v,A as S,Z as $,$ as s,af as A,a2 as D,a4 as N,c as a,V as T,ae as f,a9 as u,a7 as _,a8 as y,ab as x}from"./index-04803f90.js";import{V as U}from"./VContainer-ea35e0ea.js";import{V as b}from"./VCol-13fd31a2.js";import{V as L}from"./VDivider-3a5c5122.js";import{V as M}from"./VDataTable-a460dd9b.js";import"./VList-b1a9f752.js";import"./VSelectionControl-be5c2f2c.js";const R=f("h1",null,"購物車",-1),W={class:"btn-container"},K={__name:"CartView",setup(Z){const{apiAuth:d}=A(),c=q(),m=I(),g=D(),l=h([]),C=[{align:"center",sortable:!1,value:"name"},{title:"書本圖片",key:"book.image",align:"center"},{title:"書本名稱",key:"book.title",align:"center"},{title:"單價",key:"book.retailPrice",align:"center"},{title:"數量",key:"quantity",align:"center"},{title:"總價",key:"total",value:e=>e.book.retailPrice*e.quantity,align:"center"},{title:"操作",key:"action",align:"center"}],V=v(()=>l.value.reduce((e,o)=>e+o.quantity*o.book.retailPrice,0)),k=async(e,o)=>{var t,n;if(!m.isLogin){g.push("/login");return}try{const{data:r}=await d.patch("/users/cart",{book:e,quantity:o});m.cart=r.result,c({text:"新增成功",showCloseButton:!1,snackbarProps:{timeout:2e3,color:"green",location:"bottom"}});const i=l.value.findIndex(P=>P.book._id===e);l.value[i].quantity+=o,l.value[i].quantity<=0&&l.value.splice(i,1)}catch(r){const i=((n=(t=r==null?void 0:r.response)==null?void 0:t.data)==null?void 0:n.message)||"發生錯誤，請稍後再試";c({text:i,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom"}})}},w=v(()=>l.value.length>0),p=h(!1),B=async()=>{var e,o;p.value=!0;try{await d.post("/orders"),m.cart=0,g.push("/orders"),c({text:"結帳成功",showCloseButton:!1,snackbarProps:{timeout:2e3,color:"green",location:"bottom"}})}catch(t){const n=((o=(e=t==null?void 0:t.response)==null?void 0:e.data)==null?void 0:o.message)||"發生錯誤，請稍後再試";c({text:n,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom"}})}p.value=!1};return S(async()=>{var e,o;try{const{data:t}=await d.get("/users/cart");l.value.push(...t.result)}catch(t){const n=((o=(e=t==null?void 0:t.response)==null?void 0:e.data)==null?void 0:o.message)||"發生錯誤，請稍後再試";c({text:n,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom"}})}}),(e,o)=>(N(),$(U,null,{default:s(()=>[a(b,{cols:"12"},{default:s(()=>[R]),_:1}),a(L),a(b,{cols:"12"},{default:s(()=>[a(M,{items:l.value,headers:C},{"item.book.image":s(({item:t})=>[a(T,{src:t.book.image,alt:"Book Image","max-height":"100","max-width":"60"},null,8,["src"])]),"item.quantity":s(({item:t})=>[f("div",W,[a(u,{class:"custom-btn",variant:"text",color:"red",onClick:n=>k(t.book._id,-1)},{default:s(()=>[a(_,{href:"#icon-minus"})]),_:2},1032,["onClick"]),y(x(t.quantity),1),a(u,{class:"custom-btn",variant:"text",color:"green",onClick:n=>k(t.book._id,1)},{default:s(()=>[a(_,{href:"#icon-plus"})]),_:2},1032,["onClick"])])]),"item.action":s(({item:t})=>[a(u,{variant:"text",color:"red",onClick:n=>k(t.book._id,t.quantity*-1)},{default:s(()=>[a(_,{class:"custom-btn",href:"#icon-delete"})]),_:2},1032,["onClick"])]),_:2},1032,["items"])]),_:1}),a(b,{class:"text-center",cols:"12"},{default:s(()=>[f("p",null,"總金額: "+x(V.value),1),a(u,{color:"green",disabled:!w.value,loading:p.value,onClick:B},{default:s(()=>[y("結帳")]),_:1},8,["disabled","loading"])]),_:1})]),_:1}))}};export{K as default};
