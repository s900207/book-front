import{U as P,W as q,x as f,o as g,A as S,Z as A,_ as n,ac as D,a1 as I,a3 as N,c as o,V as $,a8 as u,a7 as v,ab as _,aa as y}from"./index-a1dc1259.js";import{V as T}from"./VContainer-725e51e7.js";import{V as b}from"./VCol-1b96f46a.js";import{V as U}from"./VDivider-b7bed0ef.js";import{V as L}from"./VDataTable-894d0ca1.js";import"./VList-bcf47bfa.js";import"./VSelectionControl-de1b2ecc.js";const M=y("h1",null,"購物車",-1),H={__name:"CartView",setup(R){const{apiAuth:d}=D(),r=P(),m=q(),h=I(),l=f([]),x=[{align:"center",sortable:!1,value:"name"},{title:"書本圖片",key:"book.image"},{title:"書本名稱",key:"book.title"},{title:"單價",key:"book.retailPrice"},{title:"數量",key:"quantity"},{title:"總價",key:"total",value:e=>e.book.retailPrice*e.quantity},{title:"操作",key:"action"}],C=g(()=>l.value.reduce((e,a)=>e+a.quantity*a.book.retailPrice,0)),k=async(e,a)=>{var t,s;if(!m.isLogin){h.push("/login");return}try{const{data:c}=await d.patch("/users/cart",{book:e,quantity:a});m.cart=c.result,r({text:"新增成功",showCloseButton:!1,snackbarProps:{timeout:2e3,color:"green",location:"bottom"}});const i=l.value.findIndex(B=>B.book._id===e);l.value[i].quantity+=a,l.value[i].quantity<=0&&l.value.splice(i,1)}catch(c){const i=((s=(t=c==null?void 0:c.response)==null?void 0:t.data)==null?void 0:s.message)||"發生錯誤，請稍後再試";r({text:i,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom"}})}},V=g(()=>l.value.length>0),p=f(!1),w=async()=>{var e,a;p.value=!0;try{await d.post("/orders"),m.cart=0,h.push("/orders"),r({text:"結帳成功",showCloseButton:!1,snackbarProps:{timeout:2e3,color:"green",location:"bottom"}})}catch(t){const s=((a=(e=t==null?void 0:t.response)==null?void 0:e.data)==null?void 0:a.message)||"發生錯誤，請稍後再試";r({text:s,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom"}})}p.value=!1};return S(async()=>{var e,a;try{const{data:t}=await d.get("/users/cart");l.value.push(...t.result)}catch(t){const s=((a=(e=t==null?void 0:t.response)==null?void 0:e.data)==null?void 0:a.message)||"發生錯誤，請稍後再試";r({text:s,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom"}})}}),(e,a)=>(N(),A(T,null,{default:n(()=>[o(b,{cols:"12"},{default:n(()=>[M]),_:1}),o(U),o(b,{cols:"12"},{default:n(()=>[o(L,{items:l.value,headers:x},{"item.book.image":n(({item:t})=>[o($,{src:t.book.image,alt:"Book Image","max-height":"100","max-width":"60"},null,8,["src"])]),"item.quantity":n(({item:t})=>[o(u,{variant:"text",icon:"mdi-minus",color:"red",onClick:s=>k(t.book._id,-1)},null,8,["onClick"]),v(_(t.quantity),1),o(u,{variant:"text",icon:"mdi-plus",color:"green",onClick:s=>k(t.book._id,1)},null,8,["onClick"])]),"item.action":n(({item:t})=>[o(u,{variant:"text",icon:"mdi-delete",color:"red",onClick:s=>k(t.book._id,t.quantity*-1)},null,8,["onClick"])]),_:2},1032,["items"])]),_:1}),o(b,{class:"text-center",cols:"12"},{default:n(()=>[y("p",null,"總金額: "+_(C.value),1),o(u,{color:"green",disabled:!V.value,loading:p.value,onClick:w},{default:n(()=>[v("結帳")]),_:1},8,["disabled","loading"])]),_:1})]),_:1}))}};export{H as default};
