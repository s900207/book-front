import{p as ae,g as te,o as F,t as f,aN as le,q as oe,u as se,c as o,a1 as re,G,U as ue,x as g,Z as ne,$ as s,a4 as de,au as k,aB as ie,a7 as me,V as ce,a9 as D,a8 as T,ay as pe,as as ge,ap as ve,aA as be,ar as Ve,aa as fe,af as ye}from"./index-9916db0b.js";import{V as Pe}from"./VContainer-511729fa.js";import{V as ke}from"./VCol-f44bf431.js";import{m as he,a as xe,b as we,c as Te,d as Be,e as Se,f as Ce,u as De,p as Ie,g as Ue,h as _e,i as qe,j as Ae,k as Fe,l as Ge,n as O,o as K,q as j,r as W}from"./VDataTable-772cd553.js";import{V as Re}from"./VForm-de1966f1.js";import{V as Ee}from"./VTextarea-1ff52f57.js";import{V as Le}from"./VRow-726a9f10.js";import"./VList-fc866f14.js";import"./VDivider-036955ab.js";import"./VSelectionControl-9ed81f2b.js";const Ne=ae({itemsLength:{type:[Number,String],required:!0},...he(),...xe(),...we()},"VDataTableServer"),He=te()({name:"VDataTableServer",props:Ne(),emits:{"update:modelValue":l=>!0,"update:page":l=>!0,"update:itemsPerPage":l=>!0,"update:sortBy":l=>!0,"update:options":l=>!0,"update:expanded":l=>!0,"update:groupBy":l=>!0},setup(l,h){let{attrs:b,slots:a}=h;const{groupBy:p}=Te(l),{sortBy:m,multiSort:x,mustSort:I}=Be(l),{page:v,itemsPerPage:y}=Se(l),P=F(()=>parseInt(l.itemsLength,10)),{columns:V,headers:r}=Ce(l,{groupBy:p,showSelect:f(l,"showSelect"),showExpand:f(l,"showExpand")}),{items:d}=De(l,V),{toggleSort:B}=Ie({sortBy:m,multiSort:x,mustSort:I,page:v}),{opened:S,isGroupOpen:U,toggleGroup:C,extractRows:_}=Ue({groupBy:p,sortBy:m}),{pageCount:u,setItemsPerPage:t}=_e({page:v,itemsPerPage:y,itemsLength:P}),{flatItems:e}=qe(d,p,S),{isSelected:n,select:i,selectAll:q,toggleSelect:Z,someSelected:z,allSelected:J}=Ae(l,{allItems:d,currentPage:d}),{isExpanded:M,toggleExpand:Q}=Fe(l),R=F(()=>_(d.value));Ge({page:v,itemsPerPage:y,sortBy:m,groupBy:p,search:f(l,"search")}),le("v-data-table",{toggleSort:B,sortBy:m}),oe({VDataTableRows:{hideNoData:f(l,"hideNoData"),noDataText:f(l,"noDataText"),loading:f(l,"loading"),loadingText:f(l,"loadingText")}});const c=F(()=>({page:v.value,itemsPerPage:y.value,sortBy:m.value,pageCount:u.value,toggleSort:B,setItemsPerPage:t,someSelected:z.value,allSelected:J.value,isSelected:n,select:i,selectAll:q,toggleSelect:Z,isExpanded:M,toggleExpand:Q,isGroupOpen:U,toggleGroup:C,items:R.value.map(A=>A.raw),internalItems:R.value,groupedItems:e.value,columns:V.value,headers:r.value}));se(()=>{const A=O.filterProps(l),X=K.filterProps(l),Y=j.filterProps(l),ee=W.filterProps(l);return o(W,G({class:["v-data-table",{"v-data-table--loading":l.loading},l.class],style:l.style},ee),{top:()=>{var w;return(w=a.top)==null?void 0:w.call(a,c.value)},default:()=>{var w,E,L,N,H,$;return a.default?a.default(c.value):o(re,null,[(w=a.colgroup)==null?void 0:w.call(a,c.value),o("thead",{class:"v-data-table__thead",role:"rowgroup"},[o(K,G(X,{sticky:l.fixedHeader}),a)]),(E=a.thead)==null?void 0:E.call(a,c.value),o("tbody",{class:"v-data-table__tbody",role:"rowgroup"},[(L=a["body.prepend"])==null?void 0:L.call(a,c.value),a.body?a.body(c.value):o(j,G(b,Y,{items:e.value}),a),(N=a["body.append"])==null?void 0:N.call(a,c.value)]),(H=a.tbody)==null?void 0:H.call(a,c.value),($=a.tfoot)==null?void 0:$.call(a,c.value)])},bottom:()=>a.bottom?a.bottom(c.value):o(O,A,{prepend:a["footer.prepend"]})})})}}),Xe={__name:"BookmanagementView",setup(l){const{apiAuth:h}=ye(),b=ue(),a=g(10),p=g([{key:"createdAt",order:"desc"}]),m=g(1),x=g([]),I=[{title:"圖片",align:"center",sortable:!1,key:"image"},{title:"書名",align:"center",sortable:!0,key:"title"},{title:"作者",align:"center",sortable:!0,key:"authors"},{title:"出版者",align:"center",sortable:!0,key:"publisher"},{title:"價格",align:"center",sortable:!0,key:"retailPrice"},{title:"分類",align:"center",sortable:!0,key:"categories"},{title:"編輯",align:"center",sortable:!1,key:"edit"},{title:"刪除",align:"center",sortable:!1,key:"delete"}],v=g(!0),y=g(0),P=g(""),V=g(!1),r=g({_id:"",title:"",authors:"",publisher:"",retailPrice:"",categories:"",description:""}),d=async()=>{var u,t,e,n;v.value=!0;try{const{data:i}=await h.get("/books/all",{params:{page:m.value,itemsPerPage:a.value,sortBy:((u=p.value[0])==null?void 0:u.key)||"createdAt",sortOrder:((t=p.value[0])==null?void 0:t.order)==="asc"?1:-1,search:P.value}});x.value.splice(0,x.value.length,...i.result.data),y.value=i.result.total}catch(i){console.log(i);const q=((n=(e=i==null?void 0:i.response)==null?void 0:e.data)==null?void 0:n.message)||"發生錯誤，請稍後再試";b({text:q,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom"}})}v.value=!1};d();const B=async u=>{var t,e;if(console.log(u),!u._id){console.error("沒有書籍 ID");return}try{await h.delete(`/books/${u._id}`),b({text:"書籍已成功刪除",showCloseButton:!1,snackbarProps:{timeout:2e3,color:"green",location:"bottom"}}),d()}catch(n){console.log(n);const i=((e=(t=n==null?void 0:n.response)==null?void 0:t.data)==null?void 0:e.message)||"刪除書籍時發生錯誤，請稍後再試";b({text:i,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom"}})}},S=()=>{m.value=1,d()},U=u=>{r.value={...u},V.value=!0},C=()=>{V.value=!1},_=async()=>{var u,t;try{await h.patch(`/books/${r.value._id}`,r.value),b({text:"書籍已成功更新",showCloseButton:!1,snackbarProps:{timeout:2e3,color:"green",location:"bottom"}}),d(),C()}catch(e){console.log(e);const n=((t=(u=e==null?void 0:e.response)==null?void 0:u.data)==null?void 0:t.message)||"更新書籍時發生錯誤，請稍後再試";b({text:n,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom"}})}};return(u,t)=>(de(),ne(Pe,null,{default:s(()=>[o(Le,null,{default:s(()=>[o(ke,{cols:"12"},{default:s(()=>[o(He,{"items-per-page":a.value,"onUpdate:itemsPerPage":[t[1]||(t[1]=e=>a.value=e),d],"sort-by":p.value,"onUpdate:sortBy":[t[2]||(t[2]=e=>p.value=e),d],page:m.value,"onUpdate:page":[t[3]||(t[3]=e=>m.value=e),d],items:x.value,headers:I,loading:v.value,"items-length":y.value,search:P.value,hover:""},{top:s(()=>[o(k,{label:"搜尋",modelValue:P.value,"onUpdate:modelValue":t[0]||(t[0]=e=>P.value=e),"onClick:append":S,onKeydown:ie(S,["enter"])},{"append-inner":s(()=>[o(me,{href:"#icon-magnify"})]),_:1},8,["modelValue"])]),"item.image":s(({item:e})=>[o(ce,{src:e.image},null,8,["src"])]),"item.edit":s(({item:e})=>[o(D,{onClick:n=>U(e)},{default:s(()=>[T("編輯")]),_:2},1032,["onClick"])]),"item.delete":s(({item:e})=>[o(D,{onClick:n=>B(e)},{default:s(()=>[T("刪除")]),_:2},1032,["onClick"])]),_:2},1032,["items-per-page","sort-by","page","items","loading","items-length","search"]),o(pe,{modelValue:V.value,"onUpdate:modelValue":t[10]||(t[10]=e=>V.value=e),persistent:"","max-width":"600px"},{default:s(()=>[o(ge,null,{default:s(()=>[o(ve,null,{default:s(()=>[T("編輯書籍")]),_:1}),o(be,null,{default:s(()=>[o(Re,{ref:"editForm"},{default:s(()=>[o(k,{modelValue:r.value.title,"onUpdate:modelValue":t[4]||(t[4]=e=>r.value.title=e),label:"書名",required:""},null,8,["modelValue"]),o(k,{modelValue:r.value.authors,"onUpdate:modelValue":t[5]||(t[5]=e=>r.value.authors=e),label:"作者",required:""},null,8,["modelValue"]),o(k,{modelValue:r.value.publisher,"onUpdate:modelValue":t[6]||(t[6]=e=>r.value.publisher=e),label:"出版者",required:""},null,8,["modelValue"]),o(k,{modelValue:r.value.retailPrice,"onUpdate:modelValue":t[7]||(t[7]=e=>r.value.retailPrice=e),label:"價格",required:"",type:"number"},null,8,["modelValue"]),o(k,{modelValue:r.value.categories,"onUpdate:modelValue":t[8]||(t[8]=e=>r.value.categories=e),label:"分類",required:""},null,8,["modelValue"]),o(Ee,{modelValue:r.value.description,"onUpdate:modelValue":t[9]||(t[9]=e=>r.value.description=e),label:"簡介",rows:"5"},null,8,["modelValue"])]),_:1},512)]),_:1}),o(Ve,null,{default:s(()=>[o(fe),o(D,{color:"blue darken-1",text:"",onClick:C},{default:s(()=>[T("取消")]),_:1}),o(D,{color:"blue darken-1",text:"",onClick:_},{default:s(()=>[T("保存")]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}))}};export{Xe as default};
