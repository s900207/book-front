import{x as ue,y as de,z as H,A as ce,B as fe,g as me,C as ve,r as G,L as he,D as ge,_ as J,t as pe,s as Z,w as K,V as we,E as ke,F as $,G as _e,i as E,H as be,I as ye,J as Ve}from"./index-HrWs0WCB.js";import{b as v,t as O,D as Ce,j as t,m as T,l as u,P as z,n as D,F as M,ac as xe,H as Q,aa as Se,a1 as U,a3 as k,a2 as a,a7 as I,a8 as N,a6 as C,Z as x,u as S,o as Be,I as Ie,ad as Pe}from"./vue-vendor-DIljl67C.js";import{h as Le,i as Re,c as Ae,j as Fe,k as Te}from"./mdi-BmvWcfYN.js";import{V as P}from"./VRow-Df8TD6Qq.js";import{V as _}from"./VCol-D1sFlLEQ.js";import{V as ze}from"./VContainer-BzeYrwDW.js";import{V as W,m as De}from"./VSelectionControl-C3K6gkhb.js";import{g as Me,p as Ue,C as q,O as Ne,f as je,ae as He}from"./vuetify-vendor-CjpGIcAt.js";const $e=Ue({indeterminate:Boolean,inset:Boolean,flat:Boolean,loading:{type:[Boolean,String],default:!1},...fe(),...De()},"VSwitch"),Ee=Me()({name:"VSwitch",inheritAttrs:!1,props:$e(),emits:{"update:focused":e=>!0,"update:modelValue":e=>!0,"update:indeterminate":e=>!0},setup(e,w){let{attrs:h,slots:s}=w;const n=q(e,"indeterminate"),l=q(e,"modelValue"),{loaderClasses:m}=ue(e),{isFocused:f,focus:g,blur:b}=de(e),o=v(),i=v(),d=Ne&&window.matchMedia("(forced-colors: active)").matches,r=O(()=>typeof e.loading=="string"&&e.loading!==""?e.loading:e.color),c=Ce(),y=O(()=>e.id||`switch-${c}`);function X(){n.value&&(n.value=!1)}function Y(B){B.stopPropagation(),B.preventDefault(),o.value?.input?.click()}return je(()=>{const[B,ee]=He(h),te=H.filterProps(e),ae=W.filterProps(e);return t(H,T({ref:i,class:["v-switch",{"v-switch--flat":e.flat},{"v-switch--inset":e.inset},{"v-switch--indeterminate":n.value},m.value,e.class]},B,te,{modelValue:l.value,"onUpdate:modelValue":L=>l.value=L,id:y.value,focused:f.value,style:e.style}),{...s,default:L=>{let{id:oe,messagesId:se,isDisabled:le,isReadonly:ne,isValid:j}=L;const R={model:l,isValid:j};return t(W,T({ref:o},ae,{modelValue:l.value,"onUpdate:modelValue":[V=>l.value=V,X],id:oe.value,"aria-describedby":se.value,type:"checkbox","aria-checked":n.value?"mixed":void 0,disabled:le.value,readonly:ne.value,onFocus:g,onBlur:b},ee),{...s,default:V=>{let{backgroundColorClasses:A,backgroundColorStyles:p}=V;return u("div",{class:D(["v-switch__track",d?void 0:A.value]),style:z(p.value),onClick:Y},[s["track-true"]&&u("div",{key:"prepend",class:"v-switch__track-true"},[s["track-true"](R)]),s["track-false"]&&u("div",{key:"append",class:"v-switch__track-false"},[s["track-false"](R)])])},input:V=>{let{inputNode:A,icon:p,backgroundColorClasses:ie,backgroundColorStyles:re}=V;return u(M,null,[A,u("div",{class:D(["v-switch__thumb",{"v-switch__thumb--filled":p||e.loading},e.inset||d?void 0:ie.value]),style:z(e.inset?void 0:re.value)},[s.thumb?t(me,{defaults:{VIcon:{icon:p,size:"x-small"}}},{default:()=>[s.thumb({...R,icon:p})]}):t(ve,null,{default:()=>[e.loading?t(he,{name:"v-switch",active:!0,color:j.value===!1?void 0:r.value},{default:F=>s.loader?s.loader(F):t(ge,{active:F.isActive,color:F.color,indeterminate:!0,size:"16",width:"2"},null)}):p&&t(G,{key:String(p),icon:p,size:"x-small"},null)]})])])}})}})}),ce({},i)}}),Oe={key:0,class:"mature-badge"},We={style:{fontSize:"1.5em",color:"#750000",fontWeight:"bold"}},qe={__name:"BooksCard",props:["_id","title","authors","publisher","retailPrice","categories","description","image","maturityRating"],setup(e){const{apiAuth:w}=K(),h=e,s=pe(),n=v(!1),l=Z(),m=xe(),f=async()=>{if(!s.isLogin){m.push("/login");return}n.value=!n.value;try{const{data:o}=await w.post("/users/favorite",{bookId:h._id,isFavorite:n.value});console.log(o),s.favorite=o.result,n.value?l({text:"已加入我的最愛",showCloseButton:!1,snackbarProps:{timeout:2e3,color:"green",location:"bottom"}}):l({text:"已移除我的最愛",showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom"}})}catch(o){o.response&&o.response.status===401?m.push("/login"):(console.error(o),l({text:"發生錯誤，請稍後再試",showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom"}}))}},g=async()=>{if(!s.isLogin){m.push("/login");return}try{const{data:o}=await w.patch("/users/cart",{book:h._id,quantity:1});s.cart=o.result,l({text:"新增成功",showCloseButton:!1,snackbarProps:{timeout:2e3,color:"green",location:"bottom"}})}catch(o){const i=o?.response?.data?.message||"發生錯誤，請稍後再試";l({text:i,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom"}})}};Q(async()=>{s.isLogin&&(n.value=await b())});const b=async()=>{try{const{data:o}=await w.get("/users/favorite",{params:{bookId:h._id}});return o.result.includes(h._id)}catch(o){return console.error(o),!1}};return(o,i)=>{const d=Se("RouterLink");return k(),U(be,{class:"books-card hover-card",width:"250px",height:"380px"},{default:a(()=>[e.maturityRating==="MATURE"?(k(),I("div",Oe,i[0]||(i[0]=[u("span",{class:"mature-text"},"18+",-1)]))):N("",!0),t(d,{to:"/books/"+e._id},{default:a(()=>[t(we,{src:e.image,height:"250px"},null,8,["src"])]),_:1},8,["to"]),t(ke,null,{default:a(()=>[t(d,{class:"text-primary text-decoration-none",to:"/books/"+e._id,title:e.title,style:{fontWeight:"bold"}},{default:a(()=>[C(x(e.title),1)]),_:1},8,["to","title"])]),_:1}),t(P,{class:"justify-space-between"},{default:a(()=>[t(_,{cols:"6"},{default:a(()=>[t($,{class:"text-left",style:{width:"170px"},title:e.authors},{default:a(()=>[C(x(e.authors),1)]),_:1},8,["title"])]),_:1}),t(_,{class:"text-right",cols:"6"},{default:a(()=>[t($,null,{default:a(()=>[i[1]||(i[1]=C("$",-1)),u("span",We,x(e.retailPrice),1)]),_:1,__:[1]})]),_:1})]),_:1}),t(_e,null,{default:a(()=>[t(P,{class:"justify-center align-center"},{default:a(()=>[t(_,{cols:"6"},{default:a(()=>[t(E,{class:"btn","prepend-icon":n.value?S(Le):S(Re),color:n.value?"red":"blue",onClick:f},{default:a(()=>[C(x(n.value?"取消最愛":"加入最愛"),1)]),_:1},8,["prepend-icon","color"])]),_:1}),t(_,{cols:"6"},{default:a(()=>[t(E,{class:"btn",color:"primary","prepend-icon":S(Ae),onClick:g},{default:a(()=>i[2]||(i[2]=[C("加入購物車",-1)])),_:1,__:[2]},8,["prepend-icon"])]),_:1})]),_:1})]),_:1})]),_:1})}}},Ge=J(qe,[["__scopeId","data-v-1f089073"]]),Je={class:"loading-container"},Ze={class:"loading-content"},Ke={class:"loading-text"},Qe={class:"adult-switch-container mt-5 d-flex align-center"},Xe={class:"switch-indicators ml-2"},Ye={key:1,class:"adult-badge"},et={__name:"HomeView",setup(e){const{api:w}=K(),h=Z();window.hasShownInitialLoading||(window.hasShownInitialLoading=!1);const s=v([]),n=v(""),l=v(!1),m=v(!1),f=v(!window.hasShownInitialLoading),g=v(0);let b=null;const o=()=>{g.value=0;const d=1;b=setInterval(()=>{g.value<100?g.value+=d:(clearInterval(b),setTimeout(()=>{window.hasShownInitialLoading=!0,f.value=!1,i()},500))},30)},i=async()=>{try{const{data:d}=await w.get("/books",{params:{search:n.value,_t:Date.now()},headers:{"Cache-Control":"no-cache"}}),r=d.result.data.reduce((c,y)=>((l.value||y.maturityRating==="NOT_MATURE")&&c.push(y),c),[]);s.value=r,await Ie(),setTimeout(()=>{m.value=!0},100)}catch(d){console.log(d);const r=d?.response?.data?.message||"發生錯誤，請稍後再試";h({text:r,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom"}})}};return Q(()=>{window.hasShownInitialLoading?i():o()}),Be([n,l],()=>{f.value||(m.value=!1,i())}),(d,r)=>(k(),I(M,null,[t(ye,{class:"loading-overlay",modelValue:f.value,"onUpdate:modelValue":r[0]||(r[0]=c=>f.value=c),persistent:""},{default:a(()=>[u("div",Je,[u("div",Ze,[u("div",Ke,x(g.value)+"% Loading...",1)])])]),_:1},8,["modelValue"]),t(ze,null,{default:a(()=>[t(P,null,{default:a(()=>[t(_,{cols:"10",md:"11"},{default:a(()=>[t(Ve,{class:"mx-auto mt-5","menu-icon":"",placeholder:"請輸入書籍名稱","prepend-inner-icon":S(Fe),modelValue:n.value,"onUpdate:modelValue":r[1]||(r[1]=c=>n.value=c),disabled:f.value},null,8,["prepend-inner-icon","modelValue","disabled"])]),_:1}),t(_,{class:"d-flex mt-2 justify-end",cols:"2",md:"1"},{default:a(()=>[u("div",Qe,[t(Ee,{class:"adult-switch",modelValue:l.value,"onUpdate:modelValue":r[2]||(r[2]=c=>l.value=c),color:l.value?"red":"green","hide-details":"",density:"compact",disabled:f.value},null,8,["modelValue","color","disabled"]),u("div",Xe,[l.value?N("",!0):(k(),U(G,{key:0,color:"green",size:"small",icon:S(Te)},null,8,["icon"])),l.value?(k(),I("div",Ye,r[3]||(r[3]=[u("span",{class:"adult-text"},"18+",-1)]))):N("",!0)])])]),_:1})]),_:1}),t(P,null,{default:a(()=>[(k(!0),I(M,null,Pe(s.value,(c,y)=>(k(),U(_,{class:"d-flex justify-center",cols:"12",md:"4",xl:"2",key:c._id},{default:a(()=>[u("div",{class:D(["book-wrapper",{"animate-in":m.value}]),style:z({animationDelay:`${y*.1}s`})},[t(Ge,T({ref_for:!0},c),null,16)],6)]),_:2},1024))),128))]),_:1})]),_:1})],64))}},ut=J(et,[["__scopeId","data-v-39056e0d"]]);export{ut as default};
